"use strict";(self.webpackChunkTypeScriptModule=self.webpackChunkTypeScriptModule||[]).push([[7410],{44994:(e,t,i)=>{i.r(t),i.d(t,{ReviewerAgent:()=>Yt,ReviewerAgentLaunchType:()=>tt});var n,o,s,a,r,l=i(23182),d=i(41148),g=i(84443),u=i(34546),c=i(8520),p=i(78052),h=i(36072),v=i(40769),m=i(54858),C=i(78986),y=i(89169),f=i(23479),S=i(17617),E=i(61780);class A{constructor(e){E.h.assign(A,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_AgentProxyCopilotInputSignal"}static getBaseTypes(){return["AugLoop_Copilot_CopilotInputSignal","AugLoop_Copilot_SignalWithQueryId","AugLoop_Signals_Signal"]}static typeGuard(e){return E.h.matchesTypesFor(e,[A.getTypeName()])}}A.H_={T_:A.getTypeName(),B_:A.getBaseTypes()};class I{constructor(e){E.h.assign(I,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_ReviewSyncAgentProxyCopilotInputSignal"}static getBaseTypes(){return["AugLoop_AgentCopilot_AgentProxyCopilotInputSignal","AugLoop_Copilot_CopilotInputSignal","AugLoop_Copilot_SignalWithQueryId","AugLoop_Signals_Signal"]}static typeGuard(e){return E.h.matchesTypesFor(e,[I.getTypeName()])}}I.H_={T_:I.getTypeName(),B_:I.getBaseTypes()};class R{constructor(e){E.h.assign(R,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_AgentProxyCopilotChatHistorySignal"}static getBaseTypes(){return["AugLoop_CopilotChatHistory_CopilotChatHistorySignal","AugLoop_Signals_Signal"]}static typeGuard(e){return E.h.matchesTypesFor(e,[R.getTypeName()])}}R.H_={T_:R.getTypeName(),B_:R.getBaseTypes()};class T{constructor(e){E.h.assign(T,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_ReviewSyncAgentProxyCopilotChatHistorySignal"}static getBaseTypes(){return["AugLoop_CopilotChatHistory_CopilotChatHistorySignal","AugLoop_Signals_Signal"]}static typeGuard(e){return E.h.matchesTypesFor(e,[T.getTypeName()])}}T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};class _{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(e){E.h.assign(_,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_AgentProxyCopilotOutputAnnotation"}static getBaseTypes(){return["AugLoop_Copilot_CopilotOutputAnnotation","AugLoop_Core_Annotation"]}static typeGuard(e){return E.h.matchesTypesFor(e,[_.getTypeName()])}}_.H_={T_:_.getTypeName(),B_:_.getBaseTypes()};class w{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(e){E.h.assign(w,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_ReviewSyncAgentProxyCopilotOutputAnnotation"}static getBaseTypes(){return["AugLoop_AgentCopilot_AgentProxyCopilotOutputAnnotation","AugLoop_Copilot_CopilotOutputAnnotation","AugLoop_Core_Annotation"]}static typeGuard(e){return E.h.matchesTypesFor(e,[w.getTypeName()])}}w.H_={T_:w.getTypeName(),B_:w.getBaseTypes()};class D{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(e){E.h.assign(D,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_AgentProxyCopilotChatHistoryAnnotation"}static getBaseTypes(){return["AugLoop_CopilotChatHistory_FluxCopilotChatHistoryAnnotation","AugLoop_CopilotChatHistory_CopilotChatHistoryAnnotation","AugLoop_Core_Annotation"]}static typeGuard(e){return E.h.matchesTypesFor(e,[D.getTypeName()])}}D.H_={T_:D.getTypeName(),B_:D.getBaseTypes()};class b{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(e){E.h.assign(b,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_ReviewSyncAgentProxyCopilotChatHistoryAnnotation"}static getBaseTypes(){return["AugLoop_AgentCopilot_AgentProxyCopilotChatHistoryAnnotation","AugLoop_CopilotChatHistory_FluxCopilotChatHistoryAnnotation","AugLoop_CopilotChatHistory_CopilotChatHistoryAnnotation","AugLoop_Core_Annotation"]}static typeGuard(e){return E.h.matchesTypesFor(e,[b.getTypeName()])}}b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()},function(e){e.CREATE="CREATE",e.RETURNINGUSER="RETURNINGUSER",e.NONE="NONE"}(n||(n={})),function(e){e.CUSTOMCARD="CustomCard",e.CHATCARD="ChatCard",e.SUMMARYCARD="SummaryCard",e.SUGGESTIONCARD="SuggestionCard"}(o||(o={})),function(e){e[e.VARIABLE=0]="VARIABLE",e[e.CONFIG=1]="CONFIG"}(s||(s={})),function(e){e.Insert="Insert",e.Rewrite="Rewrite",e.Reply="Reply"}(a||(a={})),function(e){e.PROJECTS="PROJECTS",e.QUERIES="QUERIES"}(r||(r={}));var L,P,N=i(24582),F=(i(42410),i(78160));!function(e){e.ChatECCInjectionError="Chat_ECC_Injection_Error",e.CIQForcedInvokeException="CIQ_Forced_Invoke_Exception",e.CIQThemeUpdateException="CIQ_Theme_Update_Exception",e.EditorBootstrapException="Editor_Bootstrap_Exception",e.EditorShutdownException="Editor_Shutdown_Exception",e.EmailECCInjectionError="Email_ECC_Injection_Error",e.EventECCInjectionError="Event_ECC_Injection_Error",e.FileECCInjectionError="File_ECC_Injection_Error",e.PeopleECCInjectionError="People_ECC_Injection_Error",e.UnsupportedSuggestionTypeError="Unsupported_Suggestion_Type_Error"}(L||(L={})),function(e){e.EditorShutdownSuccess="Editor_Shutdown_Success",e.EditorCIQForceInvoke="Editor_CIQ_Force_Invoke",e.EditorCIQThemeUpdate="Editor_CIQ_Theme_Update",e.EditorBootstrapSuccess="Editor_Bootstrap_Success"}(P||(P={}));var U=i(25857),k=i(15232),M=i(88198),O=i(99593),x="".concat((0,M.l)({environment:"Prod"})).concat(O.Tx),B=["mc-officeEditorTonalEnabled","mc-officeEditorALEnabled","mc-enable-override-critiques:true","mc-editor-oa","maps-editor-locationsuggestions","mc-graphIntentDetection-workflow","mc-graphIntentDetection-model-flight07","mc-graphIntentDetection-model-flight15","mc-graphIntentDetection-allowlist-flight02","mc-editor-oa-nudge","mc-editor-oa-mid-tile-predictions","mc-editor-oa-flags","mc-editor-oa-address-detection","mc-editor-oa-local-business-detection","mc-editor-oa-satori-entity-detection","oa-graph-bestmatch","enable-scope-suggestions","scd-suggestions-toplevel","mc-editor-oa-settings","mc-editor-oa-ecc-annotation","mc-editor-oa-event-ecc","mc-editor-oa-scopes","mc-editor-oa-email-ecc","mc-editor-enable-meeting-banner","mc-editor-expanded-ecc-responsive","mc-editor-oa-debug","mc-editor-enable-meeting-banner"],H=function(){function e(){this.staticSettings={isAggregatedLoggingEnabled:!0,controlIconSetName:"FabricMDL2Icons",showOptionsButton:!0,synonymsEndPoint:U.i.Prod,licenseType:k.G_.Subscription,sessionType:0,upsellLink:"https://upselllink",ignoreAllEnabled:!0,ignoreOnceEnabled:!0,enableOptimizedCallingPattern:!0,maxSuggestionItemsDisplayNumber:4,maxSuggestionDisplayPerLanguageNumber:2,enableOrchestration:!0,enableE2eMetric:!0,orchestratorSettings:{enableAugLoop:!0},manageRtlInEditorUx:!1,manageRtlForProofingLanguage:!1,enhancedUpsellEnabled:!1,premiumPreviewEnabled:!1,oaSettings:{isContextualCardEnabled:!0,disableInlineSuggestionTooltips:!0,mockResults:!1,e2eMetric:!0,mockNoAugloopResults:!1,mockResultState:"Default",enableZeroQueryHintText:!0,bestMatchConfig:{enabled:!0,maxResults:q}}},this.getFlightsToTrack=function(e,t,i){var n=(0,l.__spreadArray)([],(0,l.__read)(B),!1);return(null==i?void 0:i.length)>0&&(n=n.concat.apply(n,(0,l.__spreadArray)([],(0,l.__read)(i),!1))),(null==t?void 0:t.enableChatCIQ)&&n.push("mc-editor-oa-groupchat-ecc"),(null==t?void 0:t.enableEmailCIQ)&&n.push("mc-editor-oa-email-ecc"),((null==t?void 0:t.enableTopicECC)||(null==t?void 0:t.enableTopicCIQ))&&n.push("vivatopics"),e&&n.push("mc-editor-oa-client-ecc"),(null==t?void 0:t.enableResponsiveExpandedECC)&&n.push("mc-editor-expanded-ecc-responsive"),(null==t?void 0:t.enableNewFileTidbits)&&n.push("mc-editor-enable-files-new-tidbits"),(null==t?void 0:t.enableSearchBar)&&(n.push("mc-editor-enable-searchbar"),n.push("mc-editor-attachbutton-searchbar-position")),n}}return e.prototype.composeSettings=function(e,t){var i,n,o,s,a,r,l=Object.assign({},this.staticSettings.oaSettings,{enableOaClient:null===(i=e.featureFlags)||void 0===i?void 0:i.enableHybridWorkflow,customizedEmptyECCSuggestionsString:e.customizedEmptyECCSuggestionsString,updateResultsTimeout:e.resultTime?e.resultTime:6e3,entitiesEnabled:t,scopesConfig:e.enableAutomaticScoping?{enabled:!0,maxResults:q,enableAutomaticScoping:!0}:{enabled:!0,maxResults:q,enableAutomaticScoping:!1}});return Object.assign({},this.staticSettings,{appId:e.hostAppId,flightsToTrack:this.getFlightsToTrack(!!(null===(n=e.featureFlags)||void 0===n?void 0:n.enableHybridWorkflow),e.featureFlags,e.flightsToTrack),defaultLocale:e.hostDefaultLocale,editorEndPoint:e.isDogfoodEnvironment?U.G.Lab:U.G.Prod,hostMetadata:{appName:e.hostAppName,appPlatform:e.hostAppPlatform,appScenario:e.hostAppScenario,sessionId:e.sessionId,releaseAudienceGroup:e.isDogfoodEnvironment?"Dogfood":"Production"},orchestratorSettings:{enableAugLoop:!0,augLoopEndpoint:null!==(o=e.augloopEndPoint)&&void 0!==o?o:"https://augloop-dogfood.officeppe.com",augLoopAuthTokenCallback:e.augLoopAuthTokenCallback,substrateAuthTokenCallback:e.substrateAuthTokenCallback},userId:e.userId,oaSettings:l,serviceSettings:{hybridAugloop:{enabled:!!(null===(s=e.featureFlags)||void 0===s?void 0:s.enableHybridWorkflow),enableGraphSearchLocal:!!(null===(a=e.featureFlags)||void 0===a?void 0:a.enableHybridWorkflow),wasmConfig:{binaryPath:x,scriptPath:x}}},isDarkMode:e.isDarkMode,useFluentV9:null!==(r=e.useFluentV9)&&void 0!==r&&r})},e}(),q=15;function j(e,t){var i=new H,n=function(e){var t=[];return e.forEach((function(i){t.push({enabled:!0,entityType:i,maxResults:1===e.length?void 0:q})})),t}(t);return i.composeSettings(e,n)}var V=i(58651),Q=!1;var W=function(e,t){Q&&(null==t?V.log("Chat Editor log:",e):V.log("Chat Editor log:",e,t))};function z(e){var t=null==e?void 0:e.message;return void 0!==t?t:""}var G=void 0;function J(e){G&&(G.logError(e),W(e))}function K(e,t){G&&G.logErrorTelemetry&&G.logErrorTelemetry(e,t)}function X(e,t){G&&G.logSuccessTelemetry&&G.logSuccessTelemetry(e,t)}var Y,Z,$=i(53353);!function(e){e.light="light",e.dark="dark",e.highContrast="highContrast",e.custom="custom"}(Y||(Y={})),function(e){e.URL="URL"}(Z||(Z={}));var ee=i(94329),te=i(68465),ie=i(45006),ne=i(59664),oe=i(82772),se=i(69655),ae=i(2063),re=i(36147),le=i(43338),de=i(91050),ge=(0,re.a)({palette:(0,l.__assign)((0,l.__assign)({},le.o),{themePrimary:"#C43E1C",themeSecondary:"#FF5C39",themeDark:"#DB2A82",themeDarker:"#D67540",themeTertiary:"#B1470E",themeLight:"#F6DBD4",themeDarkAlt:"#C43E1C",themeLighter:"#F558A6",themeLighterAlt:"#FFB700",neutralPrimary:"#242424",neutralLight:"#FFFFFF",neutralLighter:"#EDEBE9",neutralLighterAlt:"#D1D1D1",neutralSecondary:"#616161",neutralSecondaryAlt:"#707070",neutralTertiary:"#F0F0F0",neutralTertiaryAlt:"#F2F2F2",neutralQuaternary:"#BDBDBD",neutralQuaternaryAlt:"#424242",neutralPrimaryAlt:"#E0E0E0",neutralDark:"#242424",black:"#000000"})});(0,re.a)({palette:(0,l.__assign)((0,l.__assign)({},de.C),{themePrimary:"#CA5010",themeSecondary:"#FF5C39",themeDark:"#DB2A82",themeDarker:"#D67540",themeTertiary:"#B1470E",themeLight:"#6E220F",themeDarkAlt:"#C43E1CFF",themeLighter:"#F558A6FF",themeLighterAlt:"#FFB700FF",neutralPrimary:"#FFFFFF",neutralLight:"#292929",neutralLighter:"#757575",neutralLighterAlt:"#666666",neutralSecondary:"#616161",neutralSecondaryAlt:"#999999",neutralTertiary:"#3D3D3D",neutralTertiaryAlt:"#3D3D3D",neutralQuaternary:"#BDBDBD",neutralQuaternaryAlt:"#FFFFFF",neutralPrimaryAlt:"#E0E0E0",neutralDark:"#FFFFFF",black:"#FFFFFF"})});const ue=function(e){var t=e.themePalette,i=e.isDarkMode,n=e.children,o=e.className,s=(0,l.__assign)((0,l.__assign)({},ge.palette),t),a=(0,ae.i)(s),r=i?(0,ne.W)(a):(0,oe.a)(a);return c.createElement(se.q,{className:o,theme:r},n)};var ce,pe,he,ve=i(3471),me=i(36733),Ce=(0,ve.n)({ciqInputText:{color:me.L.colorBrandForeground1}}),ye=c.forwardRef((function(e,t){var i=e.text,n=e.id,o=e.copilotChatTheme,s=e.isDarkModeEnabled,a=(0,l.__read)((0,c.useState)(e.isLoading),2),r=a[0],d=a[1],g=(0,l.__read)((0,c.useState)(e.clpSensitivityIndicatorData),2),u=g[0],p=g[1],h=Ce();return(0,c.useImperativeHandle)(t,(function(){return{setLoading:function(e){d(e)},setSensitivity:function(e){p(e)}}})),c.createElement("span",{contentEditable:!1,className:"user-ciq-selection-id",id:n,style:{display:"inline"}},c.createElement("span",{className:h.ciqInputText},i),c.createElement("span",{style:{display:"inline-block",verticalAlign:"text-bottom"}},r?c.createElement(ie.y,{size:"extra-tiny"}):c.createElement(ue,{themePalette:o,isDarkMode:s},u&&c.createElement(te.A,{clpSensitivityIndicatorData:u}))))})),fe=function(){function e(){this.ciqId=0,this.ciqUrls=new Map,this.isHVCAppChatV2Enabled=!1,this.queryAnnotationSet=new Map}return e.prototype.renderAndTrackSelectedSuggestion=function(e,t,i,n,o,s){if(e.suggestion&&e.queryRange){++this.ciqId;var a="userCIQSelectionId-"+this.ciqId;this.ciqUrls.set(a,e.suggestion.url),this.queryAnnotationSet.set(a,e.suggestion.queryAnnotation);var r={text:e.suggestion.text,id:a,clpSensitivityIndicatorData:t,isLoading:i,copilotChatTheme:n,isDarkModeEnabled:o},d=c.createElement(ye,(0,l.__assign)((0,l.__assign)({},r),{ref:s}),null),g=document.createElement("span");if(ee.render(d,g),e.queryRange.endContainer){var u=e.queryRange.endContainer.textContent;u&&" "===u.charAt(u.length-1)&&(e.queryRange.endContainer.textContent=u.slice(0,-1),e.queryRange.setEndAfter(e.queryRange.endContainer),e.queryRange.collapse(!1))}e.queryRange.insertNode(g),g.insertAdjacentText("beforebegin"," "),e.queryRange.collapse(!1);var p=document.createTextNode(" ");e.queryRange.insertNode(p),e.queryRange.setEndAfter(p),e.queryRange.collapse(!1);var h=window.getSelection();null==h||h.removeAllRanges(),null==h||h.addRange(e.queryRange),W("renderAndTrackSelectedSuggestion: rendered suggestion")}else W("renderAndTrackSelectedSuggestion: nothing to render")},e.prototype.generatCopilotOdslSignalLinks=function(e){var t,i;if(this.ciqUrls.size<=0)W("generatCopilotOdslSignalLinks: nothing to generate");else{var n=(0,l.__spreadArray)([],(0,l.__read)(this.ciqUrls.keys()),!1);try{for(var o=(0,l.__values)(n),s=o.next();!s.done;s=o.next()){var a=s.value;e.querySelector("span#".concat(a))||this.ciqUrls.delete(a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}if(!(this.ciqUrls.size<=0)){for(var r=[],d=0,g=e.childNodes,u=0;u<g.length;u++){var c=g[u];if(c.nodeType===Node.ELEMENT_NODE){var p=c.childNodes[0];if(p&&p.className.includes("user-ciq-selection-id")&&p.id){var h=p.textContent.length;this.ciqUrls.has(p.id)&&r.push({type:Z.URL,range:[d,d+h],value:this.ciqUrls.get(p.id)}),d+=h}else"BR"===c.nodeName?d++:this.isHVCAppChatV2Enabled&&"SPAN"===c.nodeName&&(d+=c.textContent.length)}else(""!=c.textContent.trim()||d>0)&&(d+=c.textContent.length)}return W("generatCopilotOdslSignalLinks: ".concat(r.reduce((function(e,t){return e+"URL: ".concat(t.value,", range: [").concat(t.range[0],", ").concat(t.range[1],"]")}),""))),r}W("generatCopilotOdslSignalLinks: nothing to generate after cleanup")}},e.prototype.generateQueryAnnotations=function(e){var t,i;if(this.queryAnnotationSet.size<=0)W("generateQueryAnnotations: nothing to generate");else{var n=(0,l.__spreadArray)([],(0,l.__read)(this.queryAnnotationSet.keys()),!1);try{for(var o=(0,l.__values)(n),s=o.next();!s.done;s=o.next()){var a=s.value;e.querySelector("span#".concat(a))||this.queryAnnotationSet.delete(a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}if(!(this.queryAnnotationSet.size<=0)){for(var r=[],d=e.childNodes,g=0;g<d.length;g++){var u=d[g];if(u.nodeType===Node.ELEMENT_NODE){var c=u.childNodes[0];c&&c.className.includes("user-ciq-selection-id")&&c.id&&this.queryAnnotationSet.has(c.id)&&r.push(this.queryAnnotationSet.get(c.id))}}return W("generateQueryAnnotations: ".concat(r.reduce((function(e,t){return e+"URL: ".concat(t.id,", text: ").concat(t.text)}),""))),r}W("generateQueryAnnotations: nothing to generate after cleanup")}},e.prototype.setHVCAppChatV2Enabled=function(e){this.isHVCAppChatV2Enabled=e},e}(),Se={calloutStyles:{marginTop:4,width:300,borderRadius:2},containerStyles:{maxWidth:300,minWidth:300,borderRadius:2,paddingHorizontal:0,paddingTop:0,paddingBottom:8,maxHeight:400},headerStyles:{paddingHorizontal:12},shimmerStyles:{circleSize:32,gapSize:12,lineSize:160,paddingTop:8,paddingHorizontal:12},itemsStyles:{sharedItemStyles:{height:48,paddingHorizontal:12,borderRadius:0,textHorizontalPadding:12,titleFontSize:14,subtitleFontSize:12},personItemStyles:{personaCoinSize:32},fileItemStyles:{iconStyles:{margin:4}},scopeItemStyles:{height:32,iconFontSize:16,personaCoinSize:16}},footerStyles:{height:44,marginHorizontal:0,marginBottom:-4}},Ee={itemsStyles:{fileItemStyles:{iconStyles:{margin:4}}}},Ae=i(71641);function Ie(e){var t,i,n,o,s,a,r;switch(e.type){case Ae.ck.File:return s=(g=e).FileName,o=null!==(t=g.SpoId)&&void 0!==t?t:g.AccessUrl,"DownloadableUrl"===g.AccessUrlType&&(a=g.AccessUrl),a||"DownloadableUrl"!==g.AlternateAccessUrlType||(a=g.AlternateAccessUrl),a||(a=g.AccessUrl)||(a=g.AlternateAccessUrl),a?(r={QueryAnnotationType:he.File,text:s,id:o},{type:Ae.ck.File,id:o,text:s,url:a,queryAnnotation:r}):(J("File ECC injection failed due to missing AccessUrl of type ".concat(g.AccessUrlType," and missing AlternateAccessUrl of type ").concat(g.AlternateAccessUrlType)),void K(L.FileECCInjectionError,"Missing AccessUrl of type ".concat(g.AccessUrlType," and missing AlternateAccessUrl of type ").concat(g.AlternateAccessUrlType)));case Ae.ck.People:return(null==(g=e)?void 0:g.EmailAddresses)&&g.DisplayName?(s=g.DisplayName,o=g.EmailAddresses[0],a=g.EmailAddresses[0]?"mailto:".concat(g.EmailAddresses[0]):"",r={QueryAnnotationType:he.People,text:s,id:o},{type:Ae.ck.People,id:o,text:s,url:a,queryAnnotation:r}):(J("People ECC injection failed due to missing EmailAddresses or DisplayName"),void K(L.PeopleECCInjectionError,"Missing EmailAddresses or DisplayName"));case Ae.ck.Chat:if(!(null==(g=e)?void 0:g.ThreadId))return J("Chat ECC injection failed due to missing ThreadId"),void K(L.ChatECCInjectionError,"Missing ThreadId");if(void 0!==g.Name)s=g.Name;else if(g.ChatMembers){var l=g.ChatMembers.length-2,d=g.ChatMembers.slice(0,2).map((function(e){return e.DisplayName})).join(", ");l>0&&(d+=", +".concat(l)),s=d}else s="";return o=g.ThreadId,a="",r={QueryAnnotationType:he.Chat,text:s,id:o},{type:Ae.ck.Chat,id:o,text:s,url:a,queryAnnotation:r};case Ae.ck.Message:return(null==(g=e)?void 0:g.ImmutableId)?(s=g.Subject,o=null===(i=g.ImmutableId)||void 0===i?void 0:i.Id,a="",r={QueryAnnotationType:he.Message,text:s,id:o},{type:Ae.ck.Message,id:o,text:s,url:a,queryAnnotation:r}):(J("Email ECC injection failed due to missing ImmutableId"),void K(L.EmailECCInjectionError,"Missing ImmutableId"));case Ae.ck.Event:var g;return(null==(g=e)?void 0:g.OriginalId)?(s=g.Subject,o=g.OriginalId,a=null!==(n=g.WebLink)&&void 0!==n?n:"",r={QueryAnnotationType:he.Event,text:s,id:o},{type:Ae.ck.Event,id:o,text:s,url:a,queryAnnotation:r}):(J("Event ECC injection failed due to missing OriginalId"),void K(L.EventECCInjectionError,"Missing OriginalId"));default:return J("onItemSelected called with unsupported suggestion type ".concat(e.type)),void K(L.UnsupportedSuggestionTypeError,"onItemSelected called with unsupported suggestion type ".concat(e.type))}}!function(e){e.User="User",e.System="System"}(ce||(ce={})),function(e){e.None="None",e.File="File",e.Event="Event"}(pe||(pe={})),function(e){e.People="People",e.File="File",e.Topic="Topic",e.Event="Event",e.Message="Message",e.Chat="Chat"}(he||(he={}));var Re=function(){function e(e){this.editorProofingNode=void 0,this.editorClient=e}return e.prototype.shutdown=function(){try{W("Shutting down Editor"),this.editorClient.shutDown(),W("Shutting down Editor completed successfully"),X(P.EditorShutdownSuccess)}catch(e){J("Exception shutting down Editor:"+JSON.stringify(e)+" Error message: "+z(e)),K(L.EditorShutdownException," Error message: "+z(e))}this.editorClient=null},e.prototype.initializeCiq=function(e,t){var i=this;return this.editorProofingNode&&this.editorClient&&this.uninitialize(t.queryCharToUse),W("Initializing Editor for CIQ"),this.editorProofingNode=this.editorClient.spellCheck(e,".ignore-block"),this.editorClient.enableInlineSuggestionsMenu(t.entitiesEnabled,t.queryCharToUse,(function(e,i,n){W("Suggestion selected from CIQ: "+JSON.stringify(e)+" in range: "+JSON.stringify(i)),t.onItemSelected({suggestion:Ie(e),queryRange:i,parentHtmlElement:n})}),void 0,void 0,{fitToContent:!0},t.ExpanededECC?Ee:Se,void 0,void 0,void 0,void 0,t.ExpanededECC?void 0:function(e){return(0,l.__awaiter)(i,void 0,void 0,(function(){var i,n,o,s,a;return(0,l.__generator)(this,(function(r){W("".concat(null==e?void 0:e.length," suggestions found")),t.onSuggestionsUpdated&&t.onSuggestionsUpdated(e.length);try{for(i=(0,l.__values)(e),n=i.next();!n.done;n=i.next())(o=n.value).groupTitle=t.menuTitle,o.groupSubtitle=t.menuSubtitle}catch(e){s={error:e}}finally{try{n&&!n.done&&(a=i.return)&&a.call(i)}finally{if(s)throw s.error}}return[2,e]}))}))},void 0,void 0,void 0,void 0,void 0,t.getLocalItems,void 0,void 0,void 0,t.ExpanededECC),new fe},e.prototype.uninitialize=function(e){this.editorProofingNode&&this.editorClient&&(W("Uninitializing Editor"),this.editorClient.disableInlineSuggestionsMenu(e),this.editorClient.detach(this.editorProofingNode),this.editorProofingNode=void 0)},e.prototype.forceInvokeCIQMenu=function(e,t){if(this.editorProofingNode&&this.editorClient)try{W("Starting to show CIQ for force invoke"),t&&this.setCurrentScope(t),this.editorClient.showExistingMenuAtCursor(1,e,!0),W("Showing CIQ for force invoke"),X(P.EditorCIQForceInvoke)}catch(e){J("Exception showing CIQ for forced invoke:"+JSON.stringify(e)+" Error message: "+z(e)),K(L.CIQForcedInvokeException," Error message: "+z(e))}},e.prototype.updateCurrentTheme=function(e){try{switch(W("Starting to update theme for CIQ to ".concat(e)),e){case Y.light:case Y.dark:case Y.highContrast:case Y.custom:this.editorClient.updateCurrentTheme(e);break;default:throw"Unexpected themeType: ".concat(e)}W("Theme updated for CIQ"),X(P.EditorCIQThemeUpdate)}catch(e){J("Exception updating theme for CIQ:"+JSON.stringify(e)+" Error message: "+z(e)),K(L.CIQThemeUpdateException," Error message: "+z(e))}},e.prototype.normalizeCIQEntity=function(e){switch(!0){case/file/i.test(e):return $.c.File;case/(people)|(person)/i.test(e):return $.c.People;case/(event)|(meeting)/i.test(e):return $.c.Event;case/chat/i.test(e):return $.c.Chat;case/(message)|(email)/i.test(e):return $.c.Message;case/(topic)/i.test(e):return $.c.Topic;default:return}},e.prototype.setCurrentScope=function(e){if(this.editorClient){var t=this.normalizeCIQEntity(e);if(void 0!==t){var i=this.editorClient.exp_getQueryDetection();null==i||i.setCurrentScope({entityType:t},!1)}else W("Invoked setEntityScope with unsupported entity type ".concat(e))}},e.prototype.setUnsupportedEntities=function(e){if(this.editorClient){var t=this.editorClient.exp_getQueryDetection();null==t||t.setUnsupportedEntities(e)}},e}(),Te=function(){function e(){}return e.prototype.bootstrap=function(e){return(0,l.__awaiter)(this,void 0,void 0,(function(){var t,i;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:s=e.settings.isDogfoodEnvironment,Q=s,o=e.telemLogger,G=o,W("bootstrapEditor called"),n.label=1;case 1:return n.trys.push([1,5,,6]),[4,(0,F.Rc)(j(e.settings,e.entitiesSupported),e.telemSink,e.augloopSession)];case 2:return[4,(t=n.sent()).initializeSDK()];case 3:return n.sent(),[4,t.initializeUX(document)];case 4:return n.sent(),this.chatEditor=new Re(t),W("bootstrapEditor completed successfully"),X(P.EditorBootstrapSuccess),[3,6];case 5:throw i=n.sent(),J("Exception bootstrapping Editor:"+JSON.stringify(i)+" Error message: "+z(i)),K(L.EditorBootstrapException," Error message: "+z(i)),i;case 6:return[2,this.chatEditor]}var o,s}))}))},e.prototype.shutdown=function(){return this.chatEditor.shutdown()},e}(),_e=function(){function e(){}return e.prototype.createInstance=function(){return new Te},e}(),we=i(76035),De=i(69532),be=i(91108),Le=(0,l.__assign)((0,l.__assign)((0,l.__assign)((0,l.__assign)({color:me.L.colorNeutralForeground4,alignItems:"flex-start"},De.g.body1),{fontStyle:"normal"}),be.Pt.gap("1px")),{content:"attr(title)"}),Pe={color:me.L.colorNeutralForegroundDisabled,"@media (forced-colors: active)":{forcedColorAdjust:"none"}},Ne=(0,l.__assign)((0,l.__assign)((0,l.__assign)((0,l.__assign)({},De.g.body1),{alignItems:"flex-start",fontStyle:"normal"}),be.Pt.gap("1px")),{whiteSpace:"pre-wrap",display:"inline-block",width:"100%","&:focus":(0,l.__assign)({},be.Pt.outline(0))}),Fe={userInput:(0,l.__assign)((0,l.__assign)({},Ne),{"&:focus":(0,l.__assign)({},be.Pt.outline(0)),"&:focus::after":Le,"&::after":Le})},Ue={userInput:(0,l.__assign)((0,l.__assign)({},Ne),{"&:focus":(0,l.__assign)({},be.Pt.outline(0))})},ke={userInput:{"&:focus::after":Pe,"&::after":Pe}},Me=((0,ve.n)(Ue),(0,ve.n)(Fe)),Oe=(0,ve.n)(ke),xe=i(58651),Be=function(e){var t=e.isDisabled,i=void 0!==t&&t,n=e.placeholderText,o=void 0===n?"":n,s=e.editorProps,a=e.onItemSelected,r=e.overrideStyles,d=e.startInMenuOpenState,g=e.queryCharToUse,u=null!=g?g:"/",p=c.useRef(),h=(0,c.useRef)(!0),v=(0,l.__read)(c.useState(void 0),2),m=v[0],C=v[1],y=(0,c.useRef)(null),f=(0,l.__read)((0,c.useState)(void 0),2),S=f[0],E=f[1],A=(0,l.__read)((0,c.useState)(o),2),I=A[0],R=A[1],T=c.useCallback((function(){var e,t,n,o;if(!i&&(null==s?void 0:s.handleInChatInput)&&(null==s?void 0:s.editorConfig)&&!p.current&&(null==s?void 0:s.alSession)){if(!h.current)return null===(t=null===(e=null==s?void 0:s.editorConfig)||void 0===e?void 0:e.telemLogger)||void 0===t||t.logSuccessTelemetry("Editor_Bootstrap_Skipped","ShouldBootStrapEditor is false"),void xe.log("EditorBootstrapping is skipped as shouldBootStrapEditor is false");var a=(new _e).createInstance();h.current=!1,a.bootstrap((n=s.editorConfig,o=s.alSession,(0,l.__assign)((0,l.__assign)({},n),{augloopSession:o}))).then((function(e){p.current=a,C(e)}))}}),[null==s?void 0:s.alSession,null==s?void 0:s.handleInChatInput,null==s?void 0:s.editorConfig,i]);(0,c.useEffect)((function(){T()}),[T]),(0,c.useEffect)((function(){return function(){p.current&&(p.current.shutdown(),p.current=void 0,C(void 0),E(void 0),h.current=!0)}}),[null==s?void 0:s.alSession,null==s?void 0:s.handleInChatInput,null==s?void 0:s.editorConfig]),(0,c.useEffect)((function(){if((null==s?void 0:s.handleInChatInput)&&(null==s?void 0:s.editorConfig)&&!S&&m&&y.current){var t=m.initializeCiq(y.current,{menuTitle:null==s?void 0:s.editorConfig.transformFileMenuTitle,menuSubtitle:(null==s?void 0:s.editorConfig.transformFilePlaceholderText)?null==s?void 0:s.editorConfig.transformFilePlaceholderText:"",queryCharToUse:u,getLocalItems:e.getLocalItems,onItemSelected:function(e){return(0,l.__awaiter)(void 0,void 0,void 0,(function(){return(0,l.__generator)(this,(function(t){return xe.log(e),a&&a(e.suggestion),xe.log("Item Selected"),s.postCIQItemSelectionHandler&&s.postCIQItemSelectionHandler(e.suggestion),[2]}))}))},entitiesEnabled:null==s?void 0:s.editorConfig.entitiesSupported,ExpanededECC:null==s?void 0:s.editorConfig.isExpandedECCEnabled});E(t)}}),[m,S]);var _=(0,c.useRef)(Oe()),w=(0,c.useRef)(Me()),D=(0,l.__read)((0,c.useState)(w.current.userInput),2),b=D[0],L=D[1];(0,c.useEffect)((function(){i&&L((0,we.z)(w.current.userInput,_.current.userInput))}),[i]),(0,c.useEffect)((function(){var e=y.current;d&&m&&e&&S&&(e.innerText=u,e.focus(),e.lastChild?window.getSelection().setPosition(e.lastChild,e.lastChild.textContent.length):e.firstChild&&window.getSelection().setPosition(e.firstChild,e.firstChild.textContent.length),m.forceInvokeCIQMenu(u))}),[y.current,d,m,S]);return c.createElement("span",{className:b,title:I,ref:y,contentEditable:!0,onInput:function(e){""===e.target.textContent?R(o):e.target.textContent.length>0&&""!==I&&R("")},style:r})};const He="Done! Your review has been started. Feel free to ask me for a status update at any time.",qe="Check review status",je="Close this review",Ve="Edit review details",Qe="Confirm",We="Something went wrong while executing this request",ze=new Map([[S.I.EntryPointCard,"ReviewAgentEntryPointCard"],[S.I.ConfirmInvitationCard,"ReviewAgentConfirmInvitationCard"],[S.I.ReviewStatusCard,"ReviewAgentReviewStatusCard"],[S.I.SuggestionCard,"ReviewAgentSuggestionsCard"]]),Ge=["Retrieving session information...","Checking for active reviews...","Setting up context..."],Je=["Processing your request...","Setting up due date & reminders....","Notifying your reviewers...."],Ke=["Updating reviewer counts...","Analyzing recent comments...","Compiling feedback..."],Xe=["Processing feedback...","Generating actionable suggestions...","Creating a prioritized list..."],Ye=["Terminating active processes...","Clearing review data...","Finalizing review closure..."],Ze="https://microsoft.sharepoint-df.com/:w:/t/PPTOFastFoodTest/EX7Rw-e3ymlAmYUT6BVj12kBd9VTzVczouXYlEsewBGZsg?e=o2Fb5X",$e="Retry",et=864e5;var tt;!function(e){e.LAUNCH_WITH_REVIEWERS="LAUNCH_WITH_REVIEWERS",e.LAUNCH_WITHOUT_REVIEWERS="LAUNCH_WITHOUT_REVIEWERS",e.LAUNCH_FROM_TOGGLE="LAUNCH_FROM_TOGGLE"}(tt||(tt={}));class it{static generateId(){return it.operationId++,"AugLoopChatAgent-Reviewer"+it.operationId.toString()}}var nt,ot,st,at,rt;it.operationId=0,function(e){e.Client="Client",e.Server="Server"}(nt||(nt={})),function(e){e.ErrorMessage="ErrorMessage",e.ErrorCode="ErrorCode",e.ErrorType="ErrorType",e.ErrorCategory="ErrorCategory"}(ot||(ot={})),function(e){e.ReviewerAgentPeoplePickerEditorConfigNotProvided="people-picker-editor-config-not-provided"}(st||(st={})),function(e){e.AgentCreated="Agent_Created",e.AgentClosed="Agent_Closed",e.AgentStatusChanged="Agent_Status_Changed",e.WorkflowRegisterd="Workflow_Registered",e.AddDetailsButtonClicked="Add_Details_Button_Clicked",e.StartReviewButtonClicked="Start_Review_Button_Clicked",e.SendResponseToClient="Send_Response_To_Client",e.ChatPaneLoaded="Chat_Pane_Loaded",e.DefaultSignalOperation="Default_Signal_Operation",e.SendRequestToAL="Send_Request_To_AL",e.SendInitialSignal="Send_Initial_Signal",e.SendCloseAgentSignal="Send_Close_Agent_Signal",e.SendUIStateSyncSignal="Send_UI_State_Sync_Signal",e.SendUIStateSyncSignalZeroReviewers="Send_UI_State_Sync_Signal_Zero_Reviewers",e.InvitationRenderCardRequest="Invitation_Render_Card_Request",e.ProcessSummaryCard="Process_Summary_Card"}(at||(at={})),function(e){e.AgentId="AgentId",e.AgentStatus="AgentStatus",e.AgentEventType="AgentEventType",e.AgentEventParameters="AgentEventParameters"}(rt||(rt={}));const lt="";var dt,gt;!function(e){e.NONE="None",e.ONE_DAY_BEFORE="1 day before",e.THREE_DAYS_BEFORE="3 days before"}(dt||(dt={})),function(e){e.INIT="Init",e.COMPLETED="Completed",e.CRITICAL="Critical",e.ACTIVE="Active",e.INACTIVE="Inactive",e.FAILED="Failed",e.EXPIRED="Expired"}(gt||(gt={}));var ut=i(21063),ct=i(59801),pt=i(98483),ht=i(58651);const vt=({displayName:e,mail:t})=>({query:"create agent",queryId:(0,pt.A)(),createAgent:{templateName:"ReviewSync",mode:n.CREATE,propValues:JSON.stringify({AUTHOR:{displayName:e,mail:t}})}}),mt=e=>({query:"Show Suggestion",queryId:(0,pt.A)(),agentId:e,suggestionCardSignal:{agentId:e}}),Ct=e=>({query:"clean up agent",agentId:e,queryId:(0,pt.A)(),cleanupSignal:{agentId:e}}),yt=(e,t)=>{const i=JSON.stringify(e);return{query:"UI STATE SYNC",queryId:(0,pt.A)(),agentId:t,uiStateSync:{jsonPayload:i}}},ft=e=>{const t=JSON.parse(e);return t?t.mode:n.NONE},St=e=>{var t;const i=null===(t=JSON.parse(e))||void 0===t?void 0:t.payload;return i?i.agentId:""},Et=(e,t)=>{var i,n;const o=null===(i=JSON.parse(e))||void 0===i?void 0:i.payload,s=null!==(n=null==o?void 0:o.agentStatus)&&void 0!==n?n:"";return""===s?t:s},At=(e,t="Hello, welcome back. How can I help you today?")=>{var i;let n;try{n=null===(i=JSON.parse(e))||void 0===i?void 0:i.payload}catch(t){ht.log("Error in parsing payload",t),ht.log("Response message",e)}return n?n.displayMessage:t},It=e=>{var t;let i;try{i=null===(t=JSON.parse(e))||void 0===t?void 0:t.payload}catch(t){ht.log("Error in parsing payload",t),ht.log("Response message",e)}return ht.log("ReviewerAgent:: payload: ",i),i},Rt=e=>void 0!==JSON.parse(e).uiType,Tt=e=>JSON.parse(e).uiType;function _t(e){if(e instanceof Date)return e;const t="string"==typeof e?parseInt(e):e;return new Date(t)}function wt(e){const t=e.trim(),i=Number(t);if(isNaN(i))return NaN;const n=parseInt(t,10);return i===n?n:NaN}function Dt(e={}){var t;const i={};for(const n in e.props||{})i[n]=null===(t=e.props[n])||void 0===t?void 0:t.defaultValue;return i}const bt=(e,t=!1)=>{const i={};for(const n of e)if(n)switch(n.kind){case f.T.DATE_PICKER:{const e=Dt(n);if(t)e.selectedDate=_t(e.selectedDate);else{const t=new Date;t.setDate(t.getDate()+7),0===t.getDay()?t.setDate(t.getDate()+1):6===t.getDay()&&t.setDate(t.getDate()+2),e.selectedDate=t}i[f.T.DATE_PICKER]=e}break;case f.T.TEXT_AREA:{const e=Dt(n);i[f.T.TEXT_AREA]=e}break;case f.T.PEOPLE_PICKER:{const e=Dt(n);i[f.T.PEOPLE_PICKER]=e}break;case f.T.DROP_DOWN:{const e=Dt(n);if(e.displayValue=dt.NONE,t){if(e.selectedValue=e.selectedValue||dt.NONE,e.selectedValue!==dt.NONE)if(isNaN(wt(e.selectedValue)))e.selectedValue=dt.NONE,e.displayValue=dt.NONE;else{const t=new Date(parseInt(e.selectedValue)).toDateString();e.displayValue=t}}else e.selectedValue=dt.NONE;i[f.T.DROP_DOWN]=e}break;case f.T.SUBMIT:{const e=Dt(n);i[f.T.SUBMIT]=e}break;default:throw new Error(`Unsupported kind: ${n.kind}`)}return i};function Lt(e=Pt){return{type:ut.j.Default,title:$e,text:$e,iconRegular:ct.DXr,iconHover:ct.fC9,handleButtonOnClick:e}}const Pt=(e,t,i)=>(0,l.__awaiter)(void 0,void 0,void 0,(function*(){Nt("Retry button clicked"),Ht.getInstance().removeActionButtonFromLastCard(),Ht.getInstance().showActionCard($e),yield Ht.getInstance().invokeReviewAgent()})),Nt=(...e)=>{ht.log("ReviewerAgent::"+(new Date).toUTCString(),...e)},Ft=e=>{const t=[],i=new Date;for(const n in dt){let o=new Date(e),s=0;switch(dt[n]){case dt.ONE_DAY_BEFORE:s=1;break;case dt.THREE_DAYS_BEFORE:s=3;break;case dt.NONE:t.push(dt.NONE);break;default:continue}const a=o.getTime()-s*et;if(s>0&&a>=i.getTime()){o=new Date(a);const e=o.toLocaleDateString(),i=`${dt[n]} (${e})`;t.push(i)}}return t};function Ut(e,t,i){return(0,l.__awaiter)(this,void 0,void 0,(function*(){Nt("ReviewerAgent:: suggestionCallback called"),yield Ht.getInstance().onApplySuggestion(e,t,i),yield Ht.getInstance().sendSuggestionActionSignal(e,i)}))}function kt(e){Nt("ReviewerAgent:: suggestion navigation clickedcalled"),Ht.getInstance().onSuggestionCardNavigation(e)}function Mt(e,t){if("None"!==e&&"None"!==t){return 0!==function(e,t){const i=Ot(e),n=Ot(t),o=(i-n)/et;return Math.floor(Math.abs(o))}(e,t)}return e!==t}function Ot(e){let t;if(!(e instanceof Date)){const i=Number(e);t=isNaN(i)?new Date(e):new Date(i)}const i=t.getTime();if(isNaN(i))throw new Error(`Provided date ${e} is invalid`);return i}function xt(e,t,i,n,o){e.sendTelemetryAgentEventData([{key:rt.AgentEventType,value:t},{key:rt.AgentEventParameters,value:i},{key:rt.AgentId,value:n},{key:rt.AgentStatus,value:o}])}var Bt=i(58651);class Ht extends p.h{sendSuggestionSignal(){var e,t,i;null===(e=this.copilotChatRef.current)||void 0===e||e.addChatMessages([{messageType:h._.ChatCardWrapper,body:{user:"human",element:"Show Suggestions"}}]);const n={documentConfig:{documentURL:this.documentURL}},o=Object.assign(Object.assign({},mt(this.agentID)),{config:n});null===(t=this.copilotChatRef.current)||void 0===t||t.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:it.generateId(),body:new I(o)}]}),workflowAnnotationType:w.getTypeName()}),null===(i=this.copilotChatRef.current)||void 0===i||i.startLoadingUi()}constructor(e,t,i,n,o,s,a,r,l,g,u){super(),this.commentId="",this.documentURL=Ze,this.userQuery="",this.authorName="",this.authorMail="",this.message="",this.date=null,this.reminder="",this.agentID="",this.agentStatus=gt.INIT,this.isInitialCardShown=!1,this.isReturningUser=!1,this.firstMessageText="",this.annotationId=void 0,this.telemetryLoggerUtils=d.j.getInstance(),this.agentLaunchType=tt.LAUNCH_WITH_REVIEWERS,this.processInvitationRenderCardRequest=e=>{var t,i,n,o,s;Bt.log("ReviewerAgent::  processInvitationRenderCardRequest response ",e);const a=It(e);Bt.log("ReviewerAgent::  processInvitationRenderCardRequest payload ",a);const r=(null==a?void 0:a.props)||(null===(t=null==a?void 0:a.additionalPayload)||void 0===t?void 0:t.props)||{},l=(null==r?void 0:r.headerText)||(null===(i=null==a?void 0:a.additionalPayload)||void 0===i?void 0:i.headerText);Bt.log("ReviewerAgent::  processInvitationRenderCardRequest payload.props ",r);const d=function(e){let t=(0,pt.A)();return t=e?`EditReviewDetails-${t}`:`${ze.get(S.I.ConfirmInvitationCard)}-${t}`,t}(this.isReturningUser);this.confirmInvitationCardProps={headerText:l,individualComponentPropsMap:bt(r,this.isReturningUser),messageId:d},this.isReturningUser?this.returningUserReviewDetailsProps=JSON.parse(JSON.stringify(this.confirmInvitationCardProps)):this.returningUserReviewDetailsProps=void 0;const g=this.confirmInvitationCardProps.individualComponentPropsMap[f.T.PEOPLE_PICKER],u=this.confirmInvitationCardProps.individualComponentPropsMap[f.T.TEXT_AREA],p=this.confirmInvitationCardProps.individualComponentPropsMap[f.T.DATE_PICKER],h=this.confirmInvitationCardProps.individualComponentPropsMap[f.T.DROP_DOWN],v=this.confirmInvitationCardProps.individualComponentPropsMap[f.T.SUBMIT];var C,y,E,A,I;this.reviewers=[],g&&(Array.isArray(g.suggestions)||(g.suggestions=(null===(n=g.suggestions)||void 0===n?void 0:n.value)||[]),this.isReturningUser?(g.suggestions.forEach((e=>{e.isReadOnly=!0})),this.reviewers=g.suggestions):g.suggestions=this.reviewers,this.peoplePickerEditorConfig||(Bt.error("ReviewerAgent::  processInvitationRenderCardRequest peoplePickerEditorConfig is not provided"),C=this.telemetryLoggerUtils,y="ReviewerAgent::  processInvitationRenderCardRequest peoplePickerEditorConfig is not provided",E=nt.Server,A=st.ReviewerAgentPeoplePickerEditorConfigNotProvided,I=m.S2.Error,C.sendTelemetryAgentErrorData([{key:ot.ErrorMessage,value:y},{key:ot.ErrorType,value:E},{key:ot.ErrorCode,value:A},{key:ot.ErrorCategory,value:I}])),g.inputComponent=((e,t,i)=>{let n;return i&&(n={editorConfig:i,alSession:e,handleInChatInput:!0}),c.createElement(Be,{editorProps:n,placeholderText:"Type / to add reviewers",onItemSelected:t})})(this.session,this.onItemSelected,this.peoplePickerEditorConfig),g.onPeopleRemoved=e=>{var t;this.reviewers=this.reviewers.filter((t=>t.mail!==e.mail)),g.suggestions=this.reviewers,this.isReturningUser&&v&&(v.isFormReadyForSubmission=this.validateBeforeSubmit()),null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage())}),u&&(this.message=u.message,u.onMessageChange=e=>{var t;Bt.log("ReviewerAgent::  onMessageChange message ",e),this.message=e,(0===this.message.trim().length||this.message.trim().length>0&&v&&!v.isFormReadyForSubmission)&&(v.isFormReadyForSubmission=this.validateBeforeSubmit(),null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage()))}),p&&(this.date=p.selectedDate.getTime(),p.onDateChange=e=>{var t;Bt.log("ReviewerAgent::  onDateChange date ",e),e.setHours(23,59,59,999),this.date=e.getTime(),this.reminder=dt.NONE,h&&(h.selectedValue=this.reminder,h.displayValue=this.reminder,h.options=Ft(this.date)),v&&(v.isFormReadyForSubmission=this.validateBeforeSubmit()),null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage())}),h&&(this.date&&(h.options=Ft(this.date)),this.reminder=h.selectedValue,h.onItemSelected=e=>{var t;if(Bt.log("ReviewerAgent::  onDateChange item ",e),e.includes("1 day")){const e=this.date-864e5;this.reminder=e.toString()}else if(e.includes("3 days")){const e=this.date-2592e5;this.reminder=e.toString()}else{const t=new Date(e);isNaN(t.getTime())?this.reminder=e:this.reminder=new Date(e).toString()}v&&(v.isFormReadyForSubmission=this.validateBeforeSubmit()),h.selectedValue=this.reminder,h.displayValue=e,null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage())}),v&&(v.onSubmit=()=>this.sendUIStateSyncSignal()),Bt.log("ReviewerAgent::  processInvitationRenderCardRequest this.confirmInvitationCardProps: ",this.confirmInvitationCardProps),this.isReturningUser||this.agentLaunchType!==tt.LAUNCH_WITH_REVIEWERS||this.showInvitationCard(),xt(this.telemetryLoggerUtils,at.InvitationRenderCardRequest,lt,null!==(o=this.agentID)&&void 0!==o?o:lt,null!==(s=this.agentStatus)&&void 0!==s?s:lt)},this.showInvitationCard=()=>{var e;this.confirmInvitationCardProps.individualComponentPropsMap[f.T.SUBMIT].isFormReadyForSubmission=this.validateBeforeSubmit(),null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage(this.getConfirmInvitationCardResponseMessage())},this.getConfirmInvitationCardResponseMessage=()=>{const e=this.confirmInvitationCardProps.messageId||ze.get(S.I.ConfirmInvitationCard);return{chatCardType:h._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.ConfirmInvitationCard,reviewAgentInternalCardProps:this.confirmInvitationCardProps}}},chatMessageBodyData:{messageId:e}}},this.onItemSelected=e=>{var t,i,n;const o={displayName:e.text,mail:e.id};if(!this.reviewers.find((e=>e.mail===o.mail))){if(this.reviewers.push(o),this.confirmInvitationCardProps.individualComponentPropsMap[f.T.PEOPLE_PICKER].suggestions=this.reviewers,this.isReturningUser){const e=null===(i=null===(t=this.confirmInvitationCardProps)||void 0===t?void 0:t.individualComponentPropsMap)||void 0===i?void 0:i[f.T.SUBMIT];e&&(e.isFormReadyForSubmission=this.validateBeforeSubmit())}null===(n=this.copilotChatRef.current)||void 0===n||n.updateMessage(this.getConfirmInvitationCardResponseMessage())}},this.copilotChatRef=e,this.session=t,this.userQuery=i||"Start a review on this document",this.documentURL=n||Ze,this.authorName=o||"Aditya Aswal",this.authorMail=s||"aditysasaaswal@microsoft.com",this.setSuggestionList=a,this.isReviewerNotAddedButtonClicked=r||!1,this.agentLaunchType=l,this.getDocumentSensitivity=g,this.peoplePickerEditorConfig=u}setCallbacks(e,t,i,n){this.onApplySuggestion=e,this.toggleChangeHandler=t,this.addCommentToFirstLineOfDocument=i,this.onSuggestionCardNavigation=n}setFastModeReviewerAgentEnabled(e){this.isFastModeReviewerAgentEnabled=e}getAgentStatus(){return this.agentStatus}static getInstance(e,t,i,n,o,s,a,r,l,d,g){return Ht.instance||(Ht.instance=new Ht(e,t,i,n,o,s,a,r,l,d,g)),Ht.instance}static destroy(){Bt.log("ReviewerAgent:: Destroying CopilotCommunicationHandlerImpl instance."),Ht.instance=void 0}getWorkflowsToRegister(){var e,t;Bt.log("ReviewerAgent:: getWorkflowsToRegister.");const i=[];return i.push({workflowAnnotationType:w.getTypeName(),shouldHandleResponse:!1,augloopResponseTimerRequired:!0,augloopResponseTimeout:65e3}),Bt.log("ReviewerAgent:: Registered workflows"),xt(this.telemetryLoggerUtils,at.WorkflowRegisterd,"ReviewerAgentWorkflowRegistered",null!==(e=this.agentID)&&void 0!==e?e:lt,null!==(t=this.agentStatus)&&void 0!==t?t:lt),i}handoffInitialCard(){this.isInitialCardShown||this.agentLaunchType==tt.LAUNCH_FROM_TOGGLE||(this.showStartupCard(),this.isInitialCardShown=!0)}showStartupCard(){var e;null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:h._.Default,chatMessageData:{defaultMessageProps:{user:"human",messageHeader:{text:"Start reviewersync"}}},stopLoadingUi:!0})}showAcknowledgementCard(){var e;this.isReviewerNotAddedButtonClicked&&(this.firstMessageText=He),this.firstMessageText&&(null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:h._.MarkdownCard,chatMessageData:{markDownCardProps:{message:this.firstMessageText}},stopLoadingUi:!0}))}getPlainTextChatCardResponse(e,t="chat",i=!0){return{chatCardType:h._.Default,chatMessageData:{defaultMessageProps:{user:t,messageHeader:{text:e}}},stopLoadingUi:i}}handleRetryButtonClickedForAgentFailure(e,t,i){return(0,l.__awaiter)(this,void 0,void 0,(function*(){this.sendUIStateSyncSignal(),this.removeActionButtonFromLastCard()}))}sendResponseToClient(e){var t,i,s,a,r,l,d,g,u,c,p,v,m,C,y,f,E,A,I,R,T,_;Bt.log("ReviewerAgent:: SendResponseToClient.",e),this.isReturningUser=!1;const w=e.id;if(!this.annotationId||this.annotationId!==w){if(this.annotationId&&this.annotationId===w||(this.annotationId=w),(null===(t=e.body.chatResponse)||void 0===t?void 0:t.status)===N.lC.Success){this.handoffInitialCard();const t=null===(i=e.body.chatResponse)||void 0===i?void 0:i.messages;if((null==t?void 0:t.length)>=2){this.agentLaunchType===tt.LAUNCH_FROM_TOGGLE&&(null===(s=this.copilotChatRef.current)||void 0===s||s.addResponseMessage({chatCardType:h._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.EntryPointCard,reviewAgentInternalCardProps:{isTriggeredFromReviewerAgentPane:!0,onAddDetailsButtonClick:()=>{var e,t;this.isReviewerNotAddedButtonClicked=!1,this.showAcknowledgementCard(),this.showInvitationCard(),Bt.log("onAddDetailsButtonClick"),xt(this.telemetryLoggerUtils,at.AddDetailsButtonClicked,lt,null!==(e=this.agentID)&&void 0!==e?e:lt,null!==(t=this.agentStatus)&&void 0!==t?t:lt)},onStartReviewButtonClick:()=>{var e,t,i;this.isReviewerNotAddedButtonClicked=!0,this.sendUIStateSyncSignalZeroReviewers(),null===(e=this.copilotChatRef.current)||void 0===e||e.startLoadingUi(),Bt.log("onStartReviewButtonClick"),xt(this.telemetryLoggerUtils,at.StartReviewButtonClicked,lt,null!==(t=this.agentID)&&void 0!==t?t:lt,null!==(i=this.agentStatus)&&void 0!==i?i:lt)}}}}}})),this.firstMessageText=this.isReviewerNotAddedButtonClicked?He:null===(a=t[0])||void 0===a?void 0:a.text,this.firstMessageText&&this.agentLaunchType!==tt.LAUNCH_FROM_TOGGLE&&(null===(r=this.copilotChatRef.current)||void 0===r||r.addResponseMessage({chatCardType:h._.MarkdownCard,chatMessageData:{markDownCardProps:{message:this.firstMessageText}},stopLoadingUi:!0}));const e=null===(l=t[1])||void 0===l?void 0:l.text;if(Bt.log("ReviewerAgent:: SendResponseToClient secondMessage mode: ",ft(e)),(e=>{ht.log("ReviewerAgent::  responseMessageText.",e);try{return void 0!==It(e)}catch(e){return ht.log("ReviewerAgent::  responseMessageText parsing error: ",e),!1}})(e)&&ft(e)===n.CREATE){Bt.log("ReviewerAgent:: Create Agent responsePayLoad: ",e),this.agentID=St(e);const t=Et(e,this.agentStatus);this.agentStatus=t,this.agentLaunchType===tt.LAUNCH_WITHOUT_REVIEWERS?this.sendUIStateSyncSignalZeroReviewers():this.processInvitationRenderCardRequest(e)}}else if(1===(null==t?void 0:t.length)&&ft(null===(d=t[0])||void 0===d?void 0:d.text)===n.RETURNINGUSER){this.isReturningUser=!0;const e=null===(g=t[0])||void 0===g?void 0:g.text;this.agentID=St(e);const i=Et(e,this.agentStatus);if(this.agentStatus=i,Rt(e)&&Tt(e)===o.SUMMARYCARD)Bt.log("ReviewerAgent:: Returning user with responsePayLoad: ",e),this.processSummaryCard(e);else if(Rt(e)&&Tt(e)===o.SUGGESTIONCARD)Bt.log("ReviewerAgent:: Returning user with responsePayLoad: ",e),this.processSuggestionCard(e);else{new Set([gt.INIT,gt.COMPLETED,gt.FAILED,gt.EXPIRED]).has(i)?this.setSuggestionList([]):this.setSuggestionList([Ve,qe,je]);const e=null===(u=t[0])||void 0===u?void 0:u.text;this.agentID=St(e),this.commentId=(e=>{var t,i;try{const n=null===(i=null===(t=JSON.parse(e))||void 0===t?void 0:t.payload)||void 0===i?void 0:i.additionalPayload;return n?n.agentCommentId:""}catch(e){return ht.log("Error in parsing agentCommentId",e),""}})(e),this.processInvitationRenderCardRequest(e);const n=Et(e,this.agentStatus);this.agentStatus=n,Bt.log("ReviewerAgent:: Returning user with responsePayLoad,show suggestion pills ");const o=this.getPlainTextChatCardResponse(At(e));null===(c=this.copilotChatRef.current)||void 0===c||c.addResponseMessage(o)}}}else if((null===(p=e.body.chatResponse)||void 0===p?void 0:p.status)===N.lC.ErrorInExecution){const t=(null===(C=null===(m=null===(v=e.body.chatResponse)||void 0===v?void 0:v.messages)||void 0===m?void 0:m[0])||void 0===C?void 0:C.text)||"{}",i=It(t),n=this.getPlainTextChatCardResponse(At(t,We));if((null==i?void 0:i.agentStatus)===gt.INIT&&this.confirmInvitationCardProps&&this.confirmInvitationCardProps.isCardSubmitted){const e=Object.assign(Object.assign({},n),{chatMessageBodyData:{actionButtonList:[Lt(this.handleRetryButtonClickedForAgentFailure.bind(this))]}});null===(y=this.copilotChatRef.current)||void 0===y||y.addResponseMessage(e),this.setSuggestionList([])}else{null===(f=this.copilotChatRef.current)||void 0===f||f.addResponseMessage(n);const e=n.chatMessageData.defaultMessageProps.messageHeader.text;e.includes("Only the document creator")&&e.includes("can initiate the review process.")?this.setSuggestionList([]):this.setSuggestionList([Ve,qe,je])}}else{const t=null===(I=null===(A=null===(E=e.body.chatResponse)||void 0===E?void 0:E.messages)||void 0===A?void 0:A[0])||void 0===I?void 0:I.text,i=this.getPlainTextChatCardResponse(At(t,We));null===(R=this.copilotChatRef.current)||void 0===R||R.addResponseMessage(i),this.setSuggestionList([Ve,qe,je])}xt(this.telemetryLoggerUtils,at.SendResponseToClient,1==this.isReturningUser?"ReturningUser":"NewUser",null!==(T=this.agentID)&&void 0!==T?T:lt,null!==(_=this.agentStatus)&&void 0!==_?_:lt)}}processSuggestionCard(e){var t,i,n,o;const s=((e,t,i,n)=>{var o,s,a;return ht.log("ReviewerAgent:: data: ",e),{suggestionIndices:((null===(a=null===(s=null===(o=null==e?void 0:e.props)||void 0===o?void 0:o[0])||void 0===s?void 0:s.props)||void 0===a?void 0:a.suggestionIndices)||[]).map((e=>({onSuggestionCardNavigation:i,onApplySuggestion:t,initialText:e.initialText,suggestedText:e.suggestedText,commentId:e.commentId,changeType:e.changeType,appName:n})))}})(It(e),Ut,kt,(null===(n=null===(i=null===(t=this.peoplePickerEditorConfig)||void 0===t?void 0:t.settings)||void 0===i?void 0:i.hostAppName)||void 0===n?void 0:n.toLowerCase())||"");null===(o=this.copilotChatRef.current)||void 0===o||o.addResponseMessage({chatCardType:h._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.SuggestionCard,reviewAgentInternalCardProps:s}}},chatMessageBodyData:{messageId:ze.get(S.I.SuggestionCard)},stopLoadingUi:!0}),this.setSuggestionList([Ve,qe,je])}processSummaryCard(e){var t,i,n,o,s;const a=It(e),r=a.props.map((e=>{let t={reviewersWithAction:[],statusMessage:"",labelForReviewedPeople:"",labelForPendingPeople:"",commentsSummaryHeader:"",commentsSummaries:[]};return t=e.props,t}));const l=null===(i=null===(t=null==a?void 0:a.props)||void 0===t?void 0:t[0])||void 0===i?void 0:i.props.areSuggestionsGenerated;null===(n=this.copilotChatRef.current)||void 0===n||n.addResponseMessage({chatCardType:h._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.ReviewStatusCard,reviewAgentInternalCardProps:r[0]}}},chatMessageBodyData:{messageId:ze.get(S.I.ReviewStatusCard)},stopLoadingUi:!0}),l?this.setSuggestionList([Ve,"Show suggestions",qe,je]):this.setSuggestionList([Ve,qe,je]),Bt.log("ReviewerAgent:: processSummaryCard payload: ",a),xt(this.telemetryLoggerUtils,at.ProcessSummaryCard,lt,null!==(o=this.agentID)&&void 0!==o?o:lt,null!==(s=this.agentStatus)&&void 0!==s?s:lt)}sendEventToClient(e,t){return(0,l.__awaiter)(this,void 0,void 0,(function*(){var t,i;Bt.log("ReviewerAgent:: SendEventToClient.",e),e==C.PV.CopilotChatLoaded&&(this.invokeReviewAgent(),xt(this.telemetryLoggerUtils,at.ChatPaneLoaded,"SendEventToClient",null!==(t=this.agentID)&&void 0!==t?t:lt,null!==(i=this.agentStatus)&&void 0!==i?i:lt))}))}invokeReviewAgent(){return(0,l.__awaiter)(this,void 0,void 0,(function*(){var e,t;(t=this.getDocumentSensitivity?yield this.getDocumentSensitivity():void 0)&&t.parent&&(ht.log("ReviewerAgent:: sensitivity: ",t),1)?null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:h._.Default,chatMessageData:{defaultMessageProps:{user:"chat",messageHeader:{text:"I'm sorry, but I can't assist you in initiating a review as this document is marked confidential. Please take a moment to review the sensitivity label and try again."}}},chatMessageBodyData:{actionButtonList:[Lt()]},stopLoadingUi:!0}):(Bt.log("ReviewerAgent:: Sending initial signal"),this.sendInitialSignal())}))}getDefaultSignalOperation(e,t,i,n,o){var s,a,r,l,d;let g;Bt.log("ReviewerAgent:: getDefaultSignalOperation.",e,t),xt(this.telemetryLoggerUtils,at.DefaultSignalOperation,e,null!==(s=this.agentID)&&void 0!==s?s:lt,null!==(a=this.agentStatus)&&void 0!==a?a:lt);const u={documentConfig:{documentURL:this.documentURL}};var c;e.toLowerCase().includes("status")?(g=Object.assign(Object.assign({},(c=this.agentID,{query:"status review of agent",queryId:(0,pt.A)(),agentId:c,summaryCardSignal:{agentId:c}})),{config:u}),null===(r=this.copilotChatRef.current)||void 0===r||r.updateLoadingComponentProps({loadingUiStringList:Ke})):e.toLowerCase().includes("close")?g=Object.assign(Object.assign({},Ct(this.agentID)),{config:u}):e.toLowerCase().includes("suggestion")?(g=Object.assign(Object.assign({},mt(this.agentID)),{config:u}),null===(l=this.copilotChatRef.current)||void 0===l||l.updateLoadingComponentProps({loadingUiStringList:Xe})):e.toLowerCase().includes("start")?(g=Object.assign(Object.assign({},vt({mail:this.authorMail,displayName:this.authorName})),{config:u}),null===(d=this.copilotChatRef.current)||void 0===d||d.updateLoadingComponentProps({loadingUiStringList:Ge})):g=Object.assign({},((e,t)=>{let i={query:e,queryId:(0,pt.A)()};return t&&(i=Object.assign(Object.assign({},i),{agentId:t})),i})(e,this.agentID));const p={operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:it.generateId(),body:new I(g)}]}),workflowAnnotationType:w.getTypeName()};return Promise.resolve(p)}getHostSettings(){return{appName:"Testing",appPlatform:"All",devBuild:!0,environment:C.DF.DEV,sessionId:"",augloopUrl:"http://localhost:20080"}}getAuthToken(){return Bt.log("ReviewerAgent:: getauthtoken"),Promise.resolve("")}shouldSendRequestToAugloop(e){var t,i,n,o,s,a,r,l;if(e.toLowerCase().includes(je.toLowerCase())){const s=new Set([gt.ACTIVE,gt.CRITICAL,gt.INACTIVE]);return xt(this.telemetryLoggerUtils,at.SendRequestToAL,e,null!==(t=this.agentID)&&void 0!==t?t:lt,null!==(i=this.agentStatus)&&void 0!==i?i:lt),s.has(this.agentStatus)?(null===(n=this.copilotChatRef.current)||void 0===n||n.addResponseMessage({chatCardType:h._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.EntryPointCard,reviewAgentInternalCardProps:{isTriggeredFromReviewerAgentPane:!0,isSecondHeaderHidden:!0,isIconHidden:!0,buttonLeftText:Qe,buttonRightText:"Cancel",reviewAgentDescriptionText:"Closing the review will end access to suggestions and summaries generated for this session. This action cannot be undone.",onAddDetailsButtonClick:()=>{Bt.log("Cancel button clicked for close agent reviewer"),this.setSuggestionList([Ve,qe,je])},onStartReviewButtonClick:()=>{var e,t;null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:h._.Default,chatMessageData:{defaultMessageProps:{user:"human",messageHeader:{text:Qe}}},stopLoadingUi:!0}),null===(t=this.copilotChatRef.current)||void 0===t||t.startLoadingUi(),this.sendCloseAgentSignal(),this.setSuggestionList([])}}}}}}),this.setSuggestionList([Ve,qe])):(null===(o=this.copilotChatRef.current)||void 0===o||o.addResponseMessage(this.getPlainTextChatCardResponse("Unable to close review at this moment.")),this.setSuggestionList([Ve,qe])),Promise.resolve(!1)}if(e.toLowerCase().includes(Ve.toLowerCase())){if(new Set([gt.ACTIVE,gt.INACTIVE,gt.CRITICAL]).has(this.agentStatus)){const e=null===(a=null===(s=this.confirmInvitationCardProps)||void 0===s?void 0:s.individualComponentPropsMap)||void 0===a?void 0:a[f.T.SUBMIT];e&&(e.isFormReadyForSubmission=this.validateBeforeSubmit()),null===(r=this.copilotChatRef.current)||void 0===r||r.addResponseMessage(this.getConfirmInvitationCardResponseMessage()),this.setSuggestionList([qe,je])}else null===(l=this.copilotChatRef.current)||void 0===l||l.addResponseMessage(this.getPlainTextChatCardResponse("Unable to edit review details at this moment.")),this.setSuggestionList([qe,je]);return Promise.resolve(!1)}return Promise.resolve(!0)}getALSession(){return(0,l.__awaiter)(this,void 0,void 0,(function*(){if(Bt.log("getALSession"),this.session)return this.session;throw new Error("Session is not undefined")}))}sendInitialSignal(){var e,t,i,n,o;Bt.log("sendInitialSignal"),xt(this.telemetryLoggerUtils,at.SendInitialSignal,lt,null!==(e=this.agentID)&&void 0!==e?e:lt,null!==(t=this.agentStatus)&&void 0!==t?t:lt);const s={documentConfig:{documentURL:this.documentURL}},a=Object.assign(Object.assign({},vt({mail:this.authorMail,displayName:this.authorName})),{config:s});null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:it.generateId(),body:new I(a)}]}),workflowAnnotationType:w.getTypeName()}),null===(n=this.copilotChatRef.current)||void 0===n||n.startLoadingUi(),null===(o=this.copilotChatRef.current)||void 0===o||o.updateLoadingComponentProps({loadingUiStringList:Ge})}sendCloseAgentSignal(){return(0,l.__awaiter)(this,void 0,void 0,(function*(){var e,t,i,n;Bt.log("sendCloseAgentSignal"),xt(this.telemetryLoggerUtils,at.SendCloseAgentSignal,lt,null!==(e=this.agentID)&&void 0!==e?e:lt,null!==(t=this.agentStatus)&&void 0!==t?t:lt);const o={documentConfig:{documentURL:this.documentURL}},s=Object.assign(Object.assign({},Ct(this.agentID)),{config:o});null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:it.generateId(),body:new I(s)}]}),workflowAnnotationType:w.getTypeName()}),null===(n=this.copilotChatRef.current)||void 0===n||n.updateLoadingComponentProps({loadingUiStringList:Ye})}))}getUpdatedReviewDetailsData(){var e,t,i,n,o,s,a,r,l;let d={};const g=null===(t=null===(e=this.returningUserReviewDetailsProps)||void 0===e?void 0:e.individualComponentPropsMap)||void 0===t?void 0:t[f.T.DATE_PICKER];"string"==typeof(null==g?void 0:g.selectedDate)&&(g.selectedDate=new Date(g.selectedDate));const u=null===(i=null==g?void 0:g.selectedDate)||void 0===i?void 0:i.getTime();this.date!==u&&(d=Object.assign(Object.assign({},d),{DUE_DATE:this.date}));const c=(null===(s=null===(o=null===(n=this.returningUserReviewDetailsProps)||void 0===n?void 0:n.individualComponentPropsMap)||void 0===o?void 0:o[f.T.DROP_DOWN])||void 0===s?void 0:s.selectedValue)||dt.NONE;Mt(this.reminder,c)&&(d=Object.assign(Object.assign({},d),{REMINDER_CADENCE:this.reminder}));const p=(null===(l=null===(r=null===(a=this.returningUserReviewDetailsProps)||void 0===a?void 0:a.individualComponentPropsMap)||void 0===r?void 0:r[f.T.PEOPLE_PICKER])||void 0===l?void 0:l.suggestions)||[],h=this.reviewers.filter((e=>!p.some((t=>e.mail===t.mail))));return h.length&&(d=Object.assign(Object.assign({},d),{REVIEWERS:h.map((e=>Object.assign(Object.assign({},e),{commentId:this.commentId,context:this.message})))})),d}getUIStateSyncData(){if(this.isReturningUser){return this.getUpdatedReviewDetailsData()}return{INVITE_EMAIL:this.message,DUE_DATE:this.date,FAST_MODE_ENABLED:this.isFastModeReviewerAgentEnabled,REMINDER_CADENCE:this.reminder,REVIEWERS:this.reviewers.map((e=>Object.assign(Object.assign({},e),{commentId:this.commentId,context:this.message}))),AUTHOR:{displayName:this.authorName,mail:this.authorMail}}}sendUIStateSyncSignal(){return(0,l.__awaiter)(this,void 0,void 0,(function*(){var e,t,i,n,o,s;this.reviewers.length>0&&(yield this.notifyClientOnReviewInitiation()),this.confirmInvitationCardProps.isCardSubmitted=!0,this.confirmInvitationCardProps.individualComponentPropsMap[f.T.SUBMIT].isFormReadyForSubmission=!1,null===(e=this.copilotChatRef.current)||void 0===e||e.updateMessage(this.getConfirmInvitationCardResponseMessage()),Bt.log("sendUIStateSyncSignal"),xt(this.telemetryLoggerUtils,at.SendUIStateSyncSignal,lt,null!==(t=this.agentID)&&void 0!==t?t:lt,null!==(i=this.agentStatus)&&void 0!==i?i:lt);const a=this.getUIStateSyncData(),r={documentConfig:{documentURL:this.documentURL}},l=Object.assign(Object.assign({},yt(a,this.agentID)),{config:r});null===(n=this.copilotChatRef.current)||void 0===n||n.startLoadingUi(),null===(o=this.copilotChatRef.current)||void 0===o||o.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:it.generateId(),body:new I(l)}]}),workflowAnnotationType:w.getTypeName()}),null===(s=this.copilotChatRef.current)||void 0===s||s.updateLoadingComponentProps({loadingUiStringList:Je}),this.setSuggestionList([qe,je])}))}validateBeforeSubmit(){if(this.isReturningUser){const e=this.getUpdatedReviewDetailsData(),t=e.DUE_DATE&&e.DUE_DATE>Date.now(),i=e.REVIEWERS&&e.REVIEWERS.length;return!(!t&&!i)}return this.message.length>0&&this.date>Date.now()}sendUIStateSyncSignalZeroReviewers(){return(0,l.__awaiter)(this,void 0,void 0,(function*(){var e,t,i;Bt.log("sendUIStateSyncSignalZeroReviewers"),xt(this.telemetryLoggerUtils,at.SendUIStateSyncSignalZeroReviewers,lt,null!==(e=this.agentID)&&void 0!==e?e:lt,null!==(t=this.agentStatus)&&void 0!==t?t:lt);const n=new Date;n.setDate(n.getDate()+7);const o={INVITE_EMAIL:"",DUE_DATE:n.getTime(),REMINDER_CADENCE:"1 day before",REVIEWERS:[],AUTHOR:{displayName:this.authorName,mail:this.authorMail}},s={documentConfig:{documentURL:this.documentURL}},a=Object.assign(Object.assign({},yt(o,this.agentID)),{config:s});Bt.log("sendUIStateSyncSignalZeroReviewers textTile",a),null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:it.generateId(),body:new I(a)}]}),workflowAnnotationType:w.getTypeName()}),this.setSuggestionList([qe,je])}))}notifyClientOnReviewInitiation(){return(0,l.__awaiter)(this,void 0,void 0,(function*(){const e=`[via Reviewer]\n\nHello ${this.reviewers.map((e=>e.displayName)).join(", ")}\n\nHere's how you can help with this document review:\n"${this.message}"`;Bt.log(e),this.commentId=yield this.addCommentToFirstLineOfDocument(null!=e?e:"Please review this document",this.commentId)}))}showActionCard(e){this.copilotChatRef.current.addResponseMessage({chatCardType:h._.Default,chatMessageData:{defaultMessageProps:{user:y.Q9.Human,messageHeader:{text:e}}}})}removeActionButtonFromLastCard(){this.copilotChatRef.current.updateLastMessage({chatCardType:h._.Default,chatMessageBodyData:{actionButtonList:[]},addCardToChatHistory:!1})}sendSuggestionActionSignal(e,t){var i;Nt("sendSuggestionActionSignal");const n={documentConfig:{documentURL:this.documentURL}},o=Object.assign(Object.assign({},((e,t,i,n)=>({query:"suggestion applied",queryId:(0,pt.A)(),agentId:e,suggestionActionSignal:{agentId:e,commentId:t,changeType:i,isValid:n}}))(this.agentID,e,t,!1)),{config:n});null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:it.generateId(),body:new I(o)}]}),workflowAnnotationType:w.getTypeName()})}}var qt=i(58651);const jt=(e,t)=>{qt.log("onAgentToggleChangeStub")},Vt=(e,t,i)=>{qt.log("onApplySuggestionStub: ",e,t,i)},Qt=e=>{qt.log("onSuggestionCardNavigationStub: ",e)},Wt=e=>(qt.log("addCommentToFirstLineOfDocument: ",e),Promise.resolve("Comment added successfully")),zt={themePrimary:"#598FEC",themeSecondary:"#8763c2",themeLight:"#0E336A",themeDark:"#464FEB",themeTertiary:"#598FEC",themeDarker:"#353696",themeMedium:"#464FEB",themeDarkAlt:"#3D91FF",themeLighterAlt:"#6CEBE2",themeLighter:"#9270FF",neutralPrimary:"#FFFFFF",neutralLight:"#292929",neutralLighter:"#757575",neutralLighterAlt:"#666666",neutralSecondaryAlt:"#FFFFFF",neutralTertiary:"#3D3D3D",neutralTertiaryAlt:"#3D3D3D",neutralQuaternaryAlt:"#FFFFFF",neutralDark:"#2461CA",black:"#FFFFFF",white:"#000000"},Gt={themePrimary:"#185abd",themeSecondary:"#8763c2",themeLight:"#D2E0F4",themeDark:"#82ABF1",themeTertiary:"#598FEC",themeDarker:"#598FEC",themeMedium:"#82ABF1",themeDarkAlt:"#3D91FF",themeLighterAlt:"#6CEBE2",themeLighter:"#9270FF",neutralLighter:"#f5f5f5",neutralDark:"#1651AA",white:"#FFFFFF"};var Jt=i(62449);const Kt=(0,ve.n)((0,Jt.f)({chatFreStack:{height:"calc(100vh - 50px)"},chatUiStack:{top:"20px"}}));var Xt=i(58651);const Yt=({isTestApp:e=!1,copilotTelemetryHandler:t,alSession:n,documentURL:o,userQuery:s,onReviewerAgentToggleChange:a,onApplySuggestion:r,addCommentToFirstLineOfDocument:p,onSuggestionCardNavigation:h,peoplePickerEditorConfig:v,isDarkModeEnabled:m=!1,isHighContrastModeEnabled:C=!1,authorName:y,authorEmail:f,isReviewerNotAddedButtonClicked:S=!1,agentLaunchType:E=tt.LAUNCH_WITH_REVIEWERS,getDocumentSensitivity:A,isReviewerToggleEnabled:I=!1})=>{Xt.log("ReviewerAgent: ",n,"IsTestApp: ",e);const R=c.useRef(null),[T,_]=(0,c.useState)([]);(0,c.useEffect)((()=>{}),[T]);const w=(e,t,i)=>(0,l.__awaiter)(void 0,void 0,void 0,(function*(){Xt.log("ReviewerAgent:: onApplySuggestionsCbk: ",e,t,i),r&&(yield r(e,t,i))})),D=e=>(0,l.__awaiter)(void 0,void 0,void 0,(function*(){Xt.log("ReviewerAgent:: onSuggestionCardNavigationStubCbk: ",e);const t=parseInt(e,16);yield h(t.toString())}));e&&(s="create agent",o="https://www.microsoft.com",y="Aditya Test",f="test@msft.com");const b=Ht.getInstance(R,e?void 0:n,s,o,y,f,_,S,E,A,v);e?b.setCallbacks(Vt,jt,Wt,Qt):b.setCallbacks(w,a,p,D);const L={settings:{hostAppId:"Word_Online",hostAppName:"Word",hostAppPlatform:"Web",hostAppScenario:"Copilot",hostDefaultLocale:"en-US",isDogfoodEnvironment:!0,resultTime:1e4},telemLogger:{logError:e=>{Xt.log("Shared Copilot CIQ Error Log: ",e)}},entitiesSupported:[],isExpandedECCEnabled:!1},P={headerText:"Reviewer",descriptionText:"I'm the ultimate partner for document reviews, and can help you launch, track progress and resolve review comments.",freImagePath:i(88065),hideGetStartedButton:!0},[N,F]=c.useState(!1),U={trySydneyToggleChecked:!1,trySydneyToggleEnabled:!1,tryWebSearchToggleEnabled:!1,trySydneyToggleOnChange:(e,t)=>{Xt.log("officeaicopilot-test-app: onChange for Try Sydney Toggle")},tryEnterpriseSearchToggleChecked:!1,tryEnterpriseSearchToggleEnabled:!1,tryEnterpriseSearchToggleOnChange:(e,t)=>{Xt.log("officeaicopilot-test-app: onChange for Enterprise Search Toggle")},tryReviewerAgentToggleChecked:!0,tryReviewerAgentToggleEnabled:I,tryReviewerAgentToggleOnChange:a,FastModeReviewerAgentToggleChecked:N,FastModeReviewerAgentToggleEnabled:b.getAgentStatus()===gt.INIT,FastModeReviewerAgentToggleOnChange:(e,t)=>{const i=!N;b.setFastModeReviewerAgentEnabled(i),F(i)}},k=Kt(),M=((e,t)=>Object.assign({isDarkModeEnabled:e,isHighContrastModeEnabled:t},e?zt:Gt))(m,C);return(0,c.useEffect)((()=>(d.j.setTelemetryHandler(t),()=>{Ht.destroy()})),[]),c.createElement(u.B,{className:"ms-welcome",style:{display:"flex",gap:"8px",margin:"0px 4px"}},e||n?c.createElement(g.zn,{style:k,chatUiProps:{chatInputV2Props:{pluginsInfo:[],chatPlaceholderMessage:"Type a message for Reviewer",editorConfig:L},changeTopicUiProps:{hideChangeTopicButton:!0},freUiProps:P,toggleUiProps:U,suggestionPillsUiProps:{suggestionList:T}},copilotCommunicationHandler:b,useALRuntime:!!e,copilotTelemetryHandler:t,ref:R,theme:M}):c.createElement("div",null,"ReviewerAgent: alSession is required for non test"))};Yt.displayName="Reviewer"},88065:(e,t,i)=>{e.exports=i.p+"assets/fre-reviewer-agent-illustration.svg"}}]);
//# sourceMappingURL=vendors~ReviewerAgent.js.map