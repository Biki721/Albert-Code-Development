"use strict";(self.webpackChunkTypeScriptModule=self.webpackChunkTypeScriptModule||[]).push([["vendors~ReviewerAgent"],{47581:(e,t,i)=>{i.d(t,{W:()=>c});var n=i(23182),o=i(41586),s=i(30080),a=i(95447),r=i(8520),d=i(13817),l=i(49119),g=i(49308),u=i(58651),c=function(e){var t=e.isDisabled,i=void 0!==t&&t,c=e.placeholderText,h=void 0===c?l.u1:c,p=e.editorProps,v=e.onItemSelected,C=e.overrideStyles,m=e.startInMenuOpenState,R=e.queryCharToUse,y=null!=R?R:o.O8,S=r.useRef(),f=(0,r.useRef)(!0),A=(0,n.__read)(r.useState(void 0),2),I=A[0],T=A[1],w=(0,r.useRef)(null),E=(0,n.__read)((0,r.useState)(void 0),2),_=E[0],D=E[1],L=(0,n.__read)((0,r.useState)(h),2),P=L[0],N=L[1],M=r.useCallback((function(){var e,t;if(!i&&(null==p?void 0:p.handleInChatInput)&&(null==p?void 0:p.editorConfig)&&!S.current&&(null==p?void 0:p.alSession)){if(!f.current)return null===(t=null===(e=null==p?void 0:p.editorConfig)||void 0===e?void 0:e.telemLogger)||void 0===t||t.logSuccessTelemetry(l.qV,"ShouldBootStrapEditor is false"),void u.log("EditorBootstrapping is skipped as shouldBootStrapEditor is false");var n=(new s.V).createInstance();f.current=!1,n.bootstrap((0,g.rc)(p.editorConfig,p.alSession)).then((function(e){S.current=n,T(e)}))}}),[null==p?void 0:p.alSession,null==p?void 0:p.handleInChatInput,null==p?void 0:p.editorConfig,i]);(0,r.useEffect)((function(){M()}),[M]),(0,r.useEffect)((function(){return function(){S.current&&(S.current.shutdown(),S.current=void 0,T(void 0),D(void 0),f.current=!0)}}),[null==p?void 0:p.alSession,null==p?void 0:p.handleInChatInput,null==p?void 0:p.editorConfig]),(0,r.useEffect)((function(){if((null==p?void 0:p.handleInChatInput)&&(null==p?void 0:p.editorConfig)&&!_&&I&&w.current){var t=I.initializeCiq(w.current,{menuTitle:null==p?void 0:p.editorConfig.transformFileMenuTitle,menuSubtitle:(null==p?void 0:p.editorConfig.transformFilePlaceholderText)?null==p?void 0:p.editorConfig.transformFilePlaceholderText:l.u1,queryCharToUse:y,getLocalItems:e.getLocalItems,onItemSelected:function(e){return(0,n.__awaiter)(void 0,void 0,void 0,(function(){return(0,n.__generator)(this,(function(t){return u.log(e),v&&v(e.suggestion),u.log("Item Selected"),p.postCIQItemSelectionHandler&&p.postCIQItemSelectionHandler(e.suggestion),[2]}))}))},entitiesEnabled:null==p?void 0:p.editorConfig.entitiesSupported,ExpanededECC:null==p?void 0:p.editorConfig.isExpandedECCEnabled});D(t)}}),[I,_]);var U=(0,r.useRef)((0,d.jD)()),O=(0,r.useRef)((0,d.TM)()),b=(0,n.__read)((0,r.useState)(O.current.userInput),2),F=b[0],k=b[1];(0,r.useEffect)((function(){i&&k((0,a.z)(O.current.userInput,U.current.userInput))}),[i]),(0,r.useEffect)((function(){var e=w.current;m&&I&&e&&_&&(e.innerText=y,e.focus(),e.lastChild?window.getSelection().setPosition(e.lastChild,e.lastChild.textContent.length):e.firstChild&&window.getSelection().setPosition(e.firstChild,e.firstChild.textContent.length),I.forceInvokeCIQMenu(y))}),[w.current,m,I,_]);return r.createElement("span",{className:F,title:P,ref:w,contentEditable:!0,onInput:function(e){e.target.textContent===l.u1?N(h):e.target.textContent.length>0&&P!==l.u1&&N(l.u1)},style:C})}},593:(e,t,i)=>{i.r(t),i.d(t,{ReviewerAgent:()=>qe,ReviewerAgentLaunchType:()=>K});var n,o,s,a,r,d=i(23182),l=i(65464),g=i(92929),u=i(23488),c=i(8520),h=i(35275),p=i(96339),v=i(83213),C=i(75560),m=i(35324),R=i(10959),y=i(80766),S=i(77784),f=i(53056);class A{constructor(e){f.h.assign(A,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_AgentProxyCopilotInputSignal"}static getBaseTypes(){return["AugLoop_Copilot_CopilotInputSignal","AugLoop_Copilot_SignalWithQueryId","AugLoop_Signals_Signal"]}static typeGuard(e){return f.h.matchesTypesFor(e,[A.getTypeName()])}}A.H_={T_:A.getTypeName(),B_:A.getBaseTypes()};class I{constructor(e){f.h.assign(I,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_ReviewSyncAgentProxyCopilotInputSignal"}static getBaseTypes(){return["AugLoop_AgentCopilot_AgentProxyCopilotInputSignal","AugLoop_Copilot_CopilotInputSignal","AugLoop_Copilot_SignalWithQueryId","AugLoop_Signals_Signal"]}static typeGuard(e){return f.h.matchesTypesFor(e,[I.getTypeName()])}}I.H_={T_:I.getTypeName(),B_:I.getBaseTypes()};class T{constructor(e){f.h.assign(T,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_AgentProxyCopilotChatHistorySignal"}static getBaseTypes(){return["AugLoop_CopilotChatHistory_CopilotChatHistorySignal","AugLoop_Signals_Signal"]}static typeGuard(e){return f.h.matchesTypesFor(e,[T.getTypeName()])}}T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};class w{constructor(e){f.h.assign(w,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_ReviewSyncAgentProxyCopilotChatHistorySignal"}static getBaseTypes(){return["AugLoop_CopilotChatHistory_CopilotChatHistorySignal","AugLoop_Signals_Signal"]}static typeGuard(e){return f.h.matchesTypesFor(e,[w.getTypeName()])}}w.H_={T_:w.getTypeName(),B_:w.getBaseTypes()};class E{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(e){f.h.assign(E,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_AgentProxyCopilotOutputAnnotation"}static getBaseTypes(){return["AugLoop_Copilot_CopilotOutputAnnotation","AugLoop_Core_Annotation"]}static typeGuard(e){return f.h.matchesTypesFor(e,[E.getTypeName()])}}E.H_={T_:E.getTypeName(),B_:E.getBaseTypes()};class _{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(e){f.h.assign(_,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_ReviewSyncAgentProxyCopilotOutputAnnotation"}static getBaseTypes(){return["AugLoop_AgentCopilot_AgentProxyCopilotOutputAnnotation","AugLoop_Copilot_CopilotOutputAnnotation","AugLoop_Core_Annotation"]}static typeGuard(e){return f.h.matchesTypesFor(e,[_.getTypeName()])}}_.H_={T_:_.getTypeName(),B_:_.getBaseTypes()};class D{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(e){f.h.assign(D,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_AgentProxyCopilotChatHistoryAnnotation"}static getBaseTypes(){return["AugLoop_CopilotChatHistory_FluxCopilotChatHistoryAnnotation","AugLoop_CopilotChatHistory_CopilotChatHistoryAnnotation","AugLoop_Core_Annotation"]}static typeGuard(e){return f.h.matchesTypesFor(e,[D.getTypeName()])}}D.H_={T_:D.getTypeName(),B_:D.getBaseTypes()};class L{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(e){f.h.assign(L,this,e)}static getTypeName(){return"AugLoop_AgentCopilot_ReviewSyncAgentProxyCopilotChatHistoryAnnotation"}static getBaseTypes(){return["AugLoop_AgentCopilot_AgentProxyCopilotChatHistoryAnnotation","AugLoop_CopilotChatHistory_FluxCopilotChatHistoryAnnotation","AugLoop_CopilotChatHistory_CopilotChatHistoryAnnotation","AugLoop_Core_Annotation"]}static typeGuard(e){return f.h.matchesTypesFor(e,[L.getTypeName()])}}L.H_={T_:L.getTypeName(),B_:L.getBaseTypes()},function(e){e.CREATE="CREATE",e.RETURNINGUSER="RETURNINGUSER",e.NONE="NONE"}(n||(n={})),function(e){e.CUSTOMCARD="CustomCard",e.CHATCARD="ChatCard",e.SUMMARYCARD="SummaryCard",e.SUGGESTIONCARD="SuggestionCard"}(o||(o={})),function(e){e[e.VARIABLE=0]="VARIABLE",e[e.CONFIG=1]="CONFIG"}(s||(s={})),function(e){e.Insert="Insert",e.Rewrite="Rewrite",e.Reply="Reply"}(a||(a={})),function(e){e.PROJECTS="PROJECTS",e.QUERIES="QUERIES"}(r||(r={}));var P=i(53937),N=i(47581);const M="Done! Your review has been started. Feel free to ask me for a status update at any time.",U="Check review status",O="Close this review",b="Edit review details",F="Confirm",k="Something went wrong while executing this request",B=new Map([[S.I.EntryPointCard,"ReviewAgentEntryPointCard"],[S.I.ConfirmInvitationCard,"ReviewAgentConfirmInvitationCard"],[S.I.ReviewStatusCard,"ReviewAgentReviewStatusCard"],[S.I.SuggestionCard,"ReviewAgentSuggestionsCard"]]),x=["Retrieving session information...","Checking for active reviews...","Setting up context..."],H=["Processing your request...","Setting up due date & reminders....","Notifying your reviewers...."],V=["Updating reviewer counts...","Analyzing recent comments...","Compiling feedback..."],j=["Processing feedback...","Generating actionable suggestions...","Creating a prioritized list..."],W=["Terminating active processes...","Clearing review data...","Finalizing review closure..."],q="https://microsoft.sharepoint-df.com/:w:/t/PPTOFastFoodTest/EX7Rw-e3ymlAmYUT6BVj12kBd9VTzVczouXYlEsewBGZsg?e=o2Fb5X",G="Retry",J=864e5;var K;!function(e){e.LAUNCH_WITH_REVIEWERS="LAUNCH_WITH_REVIEWERS",e.LAUNCH_WITHOUT_REVIEWERS="LAUNCH_WITHOUT_REVIEWERS",e.LAUNCH_FROM_TOGGLE="LAUNCH_FROM_TOGGLE"}(K||(K={}));class Q{static generateId(){return Q.operationId++,"AugLoopChatAgent-Reviewer"+Q.operationId.toString()}}var X,Y,Z,$,z;Q.operationId=0,function(e){e.Client="Client",e.Server="Server"}(X||(X={})),function(e){e.ErrorMessage="ErrorMessage",e.ErrorCode="ErrorCode",e.ErrorType="ErrorType",e.ErrorCategory="ErrorCategory"}(Y||(Y={})),function(e){e.ReviewerAgentPeoplePickerEditorConfigNotProvided="people-picker-editor-config-not-provided"}(Z||(Z={})),function(e){e.AgentCreated="Agent_Created",e.AgentClosed="Agent_Closed",e.AgentStatusChanged="Agent_Status_Changed",e.WorkflowRegisterd="Workflow_Registered",e.AddDetailsButtonClicked="Add_Details_Button_Clicked",e.StartReviewButtonClicked="Start_Review_Button_Clicked",e.SendResponseToClient="Send_Response_To_Client",e.ChatPaneLoaded="Chat_Pane_Loaded",e.DefaultSignalOperation="Default_Signal_Operation",e.SendRequestToAL="Send_Request_To_AL",e.SendInitialSignal="Send_Initial_Signal",e.SendCloseAgentSignal="Send_Close_Agent_Signal",e.SendUIStateSyncSignal="Send_UI_State_Sync_Signal",e.SendUIStateSyncSignalZeroReviewers="Send_UI_State_Sync_Signal_Zero_Reviewers",e.InvitationRenderCardRequest="Invitation_Render_Card_Request",e.ProcessSummaryCard="Process_Summary_Card"}($||($={})),function(e){e.AgentId="AgentId",e.AgentStatus="AgentStatus",e.AgentEventType="AgentEventType",e.AgentEventParameters="AgentEventParameters"}(z||(z={}));const ee="";var te,ie;!function(e){e.NONE="None",e.ONE_DAY_BEFORE="1 day before",e.THREE_DAYS_BEFORE="3 days before"}(te||(te={})),function(e){e.INIT="Init",e.COMPLETED="Completed",e.CRITICAL="Critical",e.ACTIVE="Active",e.INACTIVE="Inactive",e.FAILED="Failed",e.EXPIRED="Expired"}(ie||(ie={}));var ne=i(15554),oe=i(98801),se=i(92415),ae=i(58651);const re=({displayName:e,mail:t})=>({query:"create agent",queryId:(0,se.A)(),createAgent:{templateName:"ReviewSync",mode:n.CREATE,propValues:JSON.stringify({AUTHOR:{displayName:e,mail:t}})}}),de=e=>({query:"Show Suggestion",queryId:(0,se.A)(),agentId:e,suggestionCardSignal:{agentId:e}}),le=e=>({query:"clean up agent",agentId:e,queryId:(0,se.A)(),cleanupSignal:{agentId:e}}),ge=(e,t)=>{const i=JSON.stringify(e);return{query:"UI STATE SYNC",queryId:(0,se.A)(),agentId:t,uiStateSync:{jsonPayload:i}}},ue=e=>{const t=JSON.parse(e);return t?t.mode:n.NONE},ce=e=>{var t;const i=null===(t=JSON.parse(e))||void 0===t?void 0:t.payload;return i?i.agentId:""},he=(e,t)=>{var i,n;const o=null===(i=JSON.parse(e))||void 0===i?void 0:i.payload,s=null!==(n=null==o?void 0:o.agentStatus)&&void 0!==n?n:"";return""===s?t:s},pe=(e,t="Hello, welcome back. How can I help you today?")=>{var i;let n;try{n=null===(i=JSON.parse(e))||void 0===i?void 0:i.payload}catch(t){ae.log("Error in parsing payload",t),ae.log("Response message",e)}return n?n.displayMessage:t},ve=e=>{var t;let i;try{i=null===(t=JSON.parse(e))||void 0===t?void 0:t.payload}catch(t){ae.log("Error in parsing payload",t),ae.log("Response message",e)}return ae.log("ReviewerAgent:: payload: ",i),i},Ce=e=>void 0!==JSON.parse(e).uiType,me=e=>JSON.parse(e).uiType;function Re(e){if(e instanceof Date)return e;const t="string"==typeof e?parseInt(e):e;return new Date(t)}function ye(e){const t=e.trim(),i=Number(t);if(isNaN(i))return NaN;const n=parseInt(t,10);return i===n?n:NaN}function Se(e={}){var t;const i={};for(const n in e.props||{})i[n]=null===(t=e.props[n])||void 0===t?void 0:t.defaultValue;return i}const fe=(e,t=!1)=>{const i={};for(const n of e)if(n)switch(n.kind){case y.T.DATE_PICKER:{const e=Se(n);if(t)e.selectedDate=Re(e.selectedDate);else{const t=new Date;t.setDate(t.getDate()+7),0===t.getDay()?t.setDate(t.getDate()+1):6===t.getDay()&&t.setDate(t.getDate()+2),e.selectedDate=t}i[y.T.DATE_PICKER]=e}break;case y.T.TEXT_AREA:{const e=Se(n);i[y.T.TEXT_AREA]=e}break;case y.T.PEOPLE_PICKER:{const e=Se(n);i[y.T.PEOPLE_PICKER]=e}break;case y.T.DROP_DOWN:{const e=Se(n);if(e.displayValue=te.NONE,t){if(e.selectedValue=e.selectedValue||te.NONE,e.selectedValue!==te.NONE)if(isNaN(ye(e.selectedValue)))e.selectedValue=te.NONE,e.displayValue=te.NONE;else{const t=new Date(parseInt(e.selectedValue)).toDateString();e.displayValue=t}}else e.selectedValue=te.NONE;i[y.T.DROP_DOWN]=e}break;case y.T.SUBMIT:{const e=Se(n);i[y.T.SUBMIT]=e}break;default:throw new Error(`Unsupported kind: ${n.kind}`)}return i};function Ae(e=Ie){return{type:ne.j.Default,title:G,text:G,iconRegular:oe.DXr,iconHover:oe.fC9,handleButtonOnClick:e}}const Ie=(e,t,i)=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){Te("Retry button clicked"),Me.getInstance().removeActionButtonFromLastCard(),Me.getInstance().showActionCard(G),yield Me.getInstance().invokeReviewAgent()})),Te=(...e)=>{ae.log("ReviewerAgent::"+(new Date).toUTCString(),...e)},we=e=>{const t=[],i=new Date;for(const n in te){let o=new Date(e),s=0;switch(te[n]){case te.ONE_DAY_BEFORE:s=1;break;case te.THREE_DAYS_BEFORE:s=3;break;case te.NONE:t.push(te.NONE);break;default:continue}const a=o.getTime()-s*J;if(s>0&&a>=i.getTime()){o=new Date(a);const e=o.toLocaleDateString(),i=`${te[n]} (${e})`;t.push(i)}}return t};function Ee(e,t,i){return(0,d.__awaiter)(this,void 0,void 0,(function*(){Te("ReviewerAgent:: suggestionCallback called"),yield Me.getInstance().onApplySuggestion(e,t,i),yield Me.getInstance().sendSuggestionActionSignal(e,i)}))}function _e(e){Te("ReviewerAgent:: suggestion navigation clickedcalled"),Me.getInstance().onSuggestionCardNavigation(e)}function De(e,t){if("None"!==e&&"None"!==t){return 0!==function(e,t){const i=Le(e),n=Le(t),o=(i-n)/J;return Math.floor(Math.abs(o))}(e,t)}return e!==t}function Le(e){let t;if(!(e instanceof Date)){const i=Number(e);t=isNaN(i)?new Date(e):new Date(i)}const i=t.getTime();if(isNaN(i))throw new Error(`Provided date ${e} is invalid`);return i}function Pe(e,t,i,n,o){e.sendTelemetryAgentEventData([{key:z.AgentEventType,value:t},{key:z.AgentEventParameters,value:i},{key:z.AgentId,value:n},{key:z.AgentStatus,value:o}])}var Ne=i(58651);class Me extends h.h{sendSuggestionSignal(){var e,t,i;null===(e=this.copilotChatRef.current)||void 0===e||e.addChatMessages([{messageType:p._.ChatCardWrapper,body:{user:"human",element:"Show Suggestions"}}]);const n={documentConfig:{documentURL:this.documentURL}},o=Object.assign(Object.assign({},de(this.agentID)),{config:n});null===(t=this.copilotChatRef.current)||void 0===t||t.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:Q.generateId(),body:new I(o)}]}),workflowAnnotationType:_.getTypeName()}),null===(i=this.copilotChatRef.current)||void 0===i||i.startLoadingUi()}constructor(e,t,i,n,o,s,a,r,d,g,u){super(),this.commentId="",this.documentURL=q,this.userQuery="",this.authorName="",this.authorMail="",this.message="",this.date=null,this.reminder="",this.agentID="",this.agentStatus=ie.INIT,this.isInitialCardShown=!1,this.isReturningUser=!1,this.firstMessageText="",this.annotationId=void 0,this.telemetryLoggerUtils=l.j.getInstance(),this.agentLaunchType=K.LAUNCH_WITH_REVIEWERS,this.processInvitationRenderCardRequest=e=>{var t,i,n,o,s;Ne.log("ReviewerAgent::  processInvitationRenderCardRequest response ",e);const a=ve(e);Ne.log("ReviewerAgent::  processInvitationRenderCardRequest payload ",a);const r=(null==a?void 0:a.props)||(null===(t=null==a?void 0:a.additionalPayload)||void 0===t?void 0:t.props)||{},d=(null==r?void 0:r.headerText)||(null===(i=null==a?void 0:a.additionalPayload)||void 0===i?void 0:i.headerText);Ne.log("ReviewerAgent::  processInvitationRenderCardRequest payload.props ",r);const l=function(e){let t=(0,se.A)();return t=e?`EditReviewDetails-${t}`:`${B.get(S.I.ConfirmInvitationCard)}-${t}`,t}(this.isReturningUser);this.confirmInvitationCardProps={headerText:d,individualComponentPropsMap:fe(r,this.isReturningUser),messageId:l},this.isReturningUser?this.returningUserReviewDetailsProps=JSON.parse(JSON.stringify(this.confirmInvitationCardProps)):this.returningUserReviewDetailsProps=void 0;const g=this.confirmInvitationCardProps.individualComponentPropsMap[y.T.PEOPLE_PICKER],u=this.confirmInvitationCardProps.individualComponentPropsMap[y.T.TEXT_AREA],h=this.confirmInvitationCardProps.individualComponentPropsMap[y.T.DATE_PICKER],p=this.confirmInvitationCardProps.individualComponentPropsMap[y.T.DROP_DOWN],v=this.confirmInvitationCardProps.individualComponentPropsMap[y.T.SUBMIT];var m,R,f,A,I;this.reviewers=[],g&&(Array.isArray(g.suggestions)||(g.suggestions=(null===(n=g.suggestions)||void 0===n?void 0:n.value)||[]),this.isReturningUser?(g.suggestions.forEach((e=>{e.isReadOnly=!0})),this.reviewers=g.suggestions):g.suggestions=this.reviewers,this.peoplePickerEditorConfig||(Ne.error("ReviewerAgent::  processInvitationRenderCardRequest peoplePickerEditorConfig is not provided"),m=this.telemetryLoggerUtils,R="ReviewerAgent::  processInvitationRenderCardRequest peoplePickerEditorConfig is not provided",f=X.Server,A=Z.ReviewerAgentPeoplePickerEditorConfigNotProvided,I=C.S2.Error,m.sendTelemetryAgentErrorData([{key:Y.ErrorMessage,value:R},{key:Y.ErrorType,value:f},{key:Y.ErrorCode,value:A},{key:Y.ErrorCategory,value:I}])),g.inputComponent=((e,t,i)=>{let n;return i&&(n={editorConfig:i,alSession:e,handleInChatInput:!0}),c.createElement(N.W,{editorProps:n,placeholderText:"Type / to add reviewers",onItemSelected:t})})(this.session,this.onItemSelected,this.peoplePickerEditorConfig),g.onPeopleRemoved=e=>{var t;this.reviewers=this.reviewers.filter((t=>t.mail!==e.mail)),g.suggestions=this.reviewers,this.isReturningUser&&v&&(v.isFormReadyForSubmission=this.validateBeforeSubmit()),null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage())}),u&&(this.message=u.message,u.onMessageChange=e=>{var t;Ne.log("ReviewerAgent::  onMessageChange message ",e),this.message=e,(0===this.message.trim().length||this.message.trim().length>0&&v&&!v.isFormReadyForSubmission)&&(v.isFormReadyForSubmission=this.validateBeforeSubmit(),null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage()))}),h&&(this.date=h.selectedDate.getTime(),h.onDateChange=e=>{var t;Ne.log("ReviewerAgent::  onDateChange date ",e),e.setHours(23,59,59,999),this.date=e.getTime(),this.reminder=te.NONE,p&&(p.selectedValue=this.reminder,p.displayValue=this.reminder,p.options=we(this.date)),v&&(v.isFormReadyForSubmission=this.validateBeforeSubmit()),null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage())}),p&&(this.date&&(p.options=we(this.date)),this.reminder=p.selectedValue,p.onItemSelected=e=>{var t;if(Ne.log("ReviewerAgent::  onDateChange item ",e),e.includes("1 day")){const e=this.date-864e5;this.reminder=e.toString()}else if(e.includes("3 days")){const e=this.date-2592e5;this.reminder=e.toString()}else{const t=new Date(e);isNaN(t.getTime())?this.reminder=e:this.reminder=new Date(e).toString()}v&&(v.isFormReadyForSubmission=this.validateBeforeSubmit()),p.selectedValue=this.reminder,p.displayValue=e,null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage())}),v&&(v.onSubmit=()=>this.sendUIStateSyncSignal()),Ne.log("ReviewerAgent::  processInvitationRenderCardRequest this.confirmInvitationCardProps: ",this.confirmInvitationCardProps),this.isReturningUser||this.agentLaunchType!==K.LAUNCH_WITH_REVIEWERS||this.showInvitationCard(),Pe(this.telemetryLoggerUtils,$.InvitationRenderCardRequest,ee,null!==(o=this.agentID)&&void 0!==o?o:ee,null!==(s=this.agentStatus)&&void 0!==s?s:ee)},this.showInvitationCard=()=>{var e;this.confirmInvitationCardProps.individualComponentPropsMap[y.T.SUBMIT].isFormReadyForSubmission=this.validateBeforeSubmit(),null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage(this.getConfirmInvitationCardResponseMessage())},this.getConfirmInvitationCardResponseMessage=()=>{const e=this.confirmInvitationCardProps.messageId||B.get(S.I.ConfirmInvitationCard);return{chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.ConfirmInvitationCard,reviewAgentInternalCardProps:this.confirmInvitationCardProps}}},chatMessageBodyData:{messageId:e}}},this.onItemSelected=e=>{var t,i,n;const o={displayName:e.text,mail:e.id};if(!this.reviewers.find((e=>e.mail===o.mail))){if(this.reviewers.push(o),this.confirmInvitationCardProps.individualComponentPropsMap[y.T.PEOPLE_PICKER].suggestions=this.reviewers,this.isReturningUser){const e=null===(i=null===(t=this.confirmInvitationCardProps)||void 0===t?void 0:t.individualComponentPropsMap)||void 0===i?void 0:i[y.T.SUBMIT];e&&(e.isFormReadyForSubmission=this.validateBeforeSubmit())}null===(n=this.copilotChatRef.current)||void 0===n||n.updateMessage(this.getConfirmInvitationCardResponseMessage())}},this.copilotChatRef=e,this.session=t,this.userQuery=i||"Start a review on this document",this.documentURL=n||q,this.authorName=o||"Aditya Aswal",this.authorMail=s||"aditysasaaswal@microsoft.com",this.setSuggestionList=a,this.isReviewerNotAddedButtonClicked=r||!1,this.agentLaunchType=d,this.getDocumentSensitivity=g,this.peoplePickerEditorConfig=u}setCallbacks(e,t,i,n){this.onApplySuggestion=e,this.toggleChangeHandler=t,this.addCommentToFirstLineOfDocument=i,this.onSuggestionCardNavigation=n}setFastModeReviewerAgentEnabled(e){this.isFastModeReviewerAgentEnabled=e}getAgentStatus(){return this.agentStatus}static getInstance(e,t,i,n,o,s,a,r,d,l,g){return Me.instance||(Me.instance=new Me(e,t,i,n,o,s,a,r,d,l,g)),Me.instance}static destroy(){Ne.log("ReviewerAgent:: Destroying CopilotCommunicationHandlerImpl instance."),Me.instance=void 0}getWorkflowsToRegister(){var e,t;Ne.log("ReviewerAgent:: getWorkflowsToRegister.");const i=[];return i.push({workflowAnnotationType:_.getTypeName(),shouldHandleResponse:!1,augloopResponseTimerRequired:!0,augloopResponseTimeout:65e3}),Ne.log("ReviewerAgent:: Registered workflows"),Pe(this.telemetryLoggerUtils,$.WorkflowRegisterd,"ReviewerAgentWorkflowRegistered",null!==(e=this.agentID)&&void 0!==e?e:ee,null!==(t=this.agentStatus)&&void 0!==t?t:ee),i}handoffInitialCard(){this.isInitialCardShown||this.agentLaunchType==K.LAUNCH_FROM_TOGGLE||(this.showStartupCard(),this.isInitialCardShown=!0)}showStartupCard(){var e;null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:"human",messageHeader:{text:"Start reviewersync"}}},stopLoadingUi:!0})}showAcknowledgementCard(){var e;this.isReviewerNotAddedButtonClicked&&(this.firstMessageText=M),this.firstMessageText&&(null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:p._.MarkdownCard,chatMessageData:{markDownCardProps:{message:this.firstMessageText}},stopLoadingUi:!0}))}getPlainTextChatCardResponse(e,t="chat",i=!0){return{chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:t,messageHeader:{text:e}}},stopLoadingUi:i}}handleRetryButtonClickedForAgentFailure(e,t,i){return(0,d.__awaiter)(this,void 0,void 0,(function*(){this.sendUIStateSyncSignal(),this.removeActionButtonFromLastCard()}))}sendResponseToClient(e){var t,i,s,a,r,d,l,g,u,c,h,v,C,m,R,y,f,A,I,T,w,E;Ne.log("ReviewerAgent:: SendResponseToClient.",e),this.isReturningUser=!1;const _=e.id;if(!this.annotationId||this.annotationId!==_){if(this.annotationId&&this.annotationId===_||(this.annotationId=_),(null===(t=e.body.chatResponse)||void 0===t?void 0:t.status)===P.lC.Success){this.handoffInitialCard();const t=null===(i=e.body.chatResponse)||void 0===i?void 0:i.messages;if((null==t?void 0:t.length)>=2){this.agentLaunchType===K.LAUNCH_FROM_TOGGLE&&(null===(s=this.copilotChatRef.current)||void 0===s||s.addResponseMessage({chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.EntryPointCard,reviewAgentInternalCardProps:{isTriggeredFromReviewerAgentPane:!0,onAddDetailsButtonClick:()=>{var e,t;this.isReviewerNotAddedButtonClicked=!1,this.showAcknowledgementCard(),this.showInvitationCard(),Ne.log("onAddDetailsButtonClick"),Pe(this.telemetryLoggerUtils,$.AddDetailsButtonClicked,ee,null!==(e=this.agentID)&&void 0!==e?e:ee,null!==(t=this.agentStatus)&&void 0!==t?t:ee)},onStartReviewButtonClick:()=>{var e,t,i;this.isReviewerNotAddedButtonClicked=!0,this.sendUIStateSyncSignalZeroReviewers(),null===(e=this.copilotChatRef.current)||void 0===e||e.startLoadingUi(),Ne.log("onStartReviewButtonClick"),Pe(this.telemetryLoggerUtils,$.StartReviewButtonClicked,ee,null!==(t=this.agentID)&&void 0!==t?t:ee,null!==(i=this.agentStatus)&&void 0!==i?i:ee)}}}}}})),this.firstMessageText=this.isReviewerNotAddedButtonClicked?M:null===(a=t[0])||void 0===a?void 0:a.text,this.firstMessageText&&this.agentLaunchType!==K.LAUNCH_FROM_TOGGLE&&(null===(r=this.copilotChatRef.current)||void 0===r||r.addResponseMessage({chatCardType:p._.MarkdownCard,chatMessageData:{markDownCardProps:{message:this.firstMessageText}},stopLoadingUi:!0}));const e=null===(d=t[1])||void 0===d?void 0:d.text;if(Ne.log("ReviewerAgent:: SendResponseToClient secondMessage mode: ",ue(e)),(e=>{ae.log("ReviewerAgent::  responseMessageText.",e);try{return void 0!==ve(e)}catch(e){return ae.log("ReviewerAgent::  responseMessageText parsing error: ",e),!1}})(e)&&ue(e)===n.CREATE){Ne.log("ReviewerAgent:: Create Agent responsePayLoad: ",e),this.agentID=ce(e);const t=he(e,this.agentStatus);this.agentStatus=t,this.agentLaunchType===K.LAUNCH_WITHOUT_REVIEWERS?this.sendUIStateSyncSignalZeroReviewers():this.processInvitationRenderCardRequest(e)}}else if(1===(null==t?void 0:t.length)&&ue(null===(l=t[0])||void 0===l?void 0:l.text)===n.RETURNINGUSER){this.isReturningUser=!0;const e=null===(g=t[0])||void 0===g?void 0:g.text;this.agentID=ce(e);const i=he(e,this.agentStatus);if(this.agentStatus=i,Ce(e)&&me(e)===o.SUMMARYCARD)Ne.log("ReviewerAgent:: Returning user with responsePayLoad: ",e),this.processSummaryCard(e);else if(Ce(e)&&me(e)===o.SUGGESTIONCARD)Ne.log("ReviewerAgent:: Returning user with responsePayLoad: ",e),this.processSuggestionCard(e);else{new Set([ie.INIT,ie.COMPLETED,ie.FAILED,ie.EXPIRED]).has(i)?this.setSuggestionList([]):this.setSuggestionList([b,U,O]);const e=null===(u=t[0])||void 0===u?void 0:u.text;this.agentID=ce(e),this.commentId=(e=>{var t,i;try{const n=null===(i=null===(t=JSON.parse(e))||void 0===t?void 0:t.payload)||void 0===i?void 0:i.additionalPayload;return n?n.agentCommentId:""}catch(e){return ae.log("Error in parsing agentCommentId",e),""}})(e),this.processInvitationRenderCardRequest(e);const n=he(e,this.agentStatus);this.agentStatus=n,Ne.log("ReviewerAgent:: Returning user with responsePayLoad,show suggestion pills ");const o=this.getPlainTextChatCardResponse(pe(e));null===(c=this.copilotChatRef.current)||void 0===c||c.addResponseMessage(o)}}}else if((null===(h=e.body.chatResponse)||void 0===h?void 0:h.status)===P.lC.ErrorInExecution){const t=(null===(m=null===(C=null===(v=e.body.chatResponse)||void 0===v?void 0:v.messages)||void 0===C?void 0:C[0])||void 0===m?void 0:m.text)||"{}",i=ve(t),n=this.getPlainTextChatCardResponse(pe(t,k));if((null==i?void 0:i.agentStatus)===ie.INIT&&this.confirmInvitationCardProps&&this.confirmInvitationCardProps.isCardSubmitted){const e=Object.assign(Object.assign({},n),{chatMessageBodyData:{actionButtonList:[Ae(this.handleRetryButtonClickedForAgentFailure.bind(this))]}});null===(R=this.copilotChatRef.current)||void 0===R||R.addResponseMessage(e),this.setSuggestionList([])}else{null===(y=this.copilotChatRef.current)||void 0===y||y.addResponseMessage(n);const e=n.chatMessageData.defaultMessageProps.messageHeader.text;e.includes("Only the document creator")&&e.includes("can initiate the review process.")?this.setSuggestionList([]):this.setSuggestionList([b,U,O])}}else{const t=null===(I=null===(A=null===(f=e.body.chatResponse)||void 0===f?void 0:f.messages)||void 0===A?void 0:A[0])||void 0===I?void 0:I.text,i=this.getPlainTextChatCardResponse(pe(t,k));null===(T=this.copilotChatRef.current)||void 0===T||T.addResponseMessage(i),this.setSuggestionList([b,U,O])}Pe(this.telemetryLoggerUtils,$.SendResponseToClient,1==this.isReturningUser?"ReturningUser":"NewUser",null!==(w=this.agentID)&&void 0!==w?w:ee,null!==(E=this.agentStatus)&&void 0!==E?E:ee)}}processSuggestionCard(e){var t,i,n,o;const s=((e,t,i,n)=>{var o,s,a;return ae.log("ReviewerAgent:: data: ",e),{suggestionIndices:((null===(a=null===(s=null===(o=null==e?void 0:e.props)||void 0===o?void 0:o[0])||void 0===s?void 0:s.props)||void 0===a?void 0:a.suggestionIndices)||[]).map((e=>({onSuggestionCardNavigation:i,onApplySuggestion:t,initialText:e.initialText,suggestedText:e.suggestedText,commentId:e.commentId,changeType:e.changeType,appName:n})))}})(ve(e),Ee,_e,(null===(n=null===(i=null===(t=this.peoplePickerEditorConfig)||void 0===t?void 0:t.settings)||void 0===i?void 0:i.hostAppName)||void 0===n?void 0:n.toLowerCase())||"");null===(o=this.copilotChatRef.current)||void 0===o||o.addResponseMessage({chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.SuggestionCard,reviewAgentInternalCardProps:s}}},chatMessageBodyData:{messageId:B.get(S.I.SuggestionCard)},stopLoadingUi:!0}),this.setSuggestionList([b,U,O])}processSummaryCard(e){var t,i,n,o,s;const a=ve(e),r=a.props.map((e=>{let t={reviewersWithAction:[],statusMessage:"",labelForReviewedPeople:"",labelForPendingPeople:"",commentsSummaryHeader:"",commentsSummaries:[]};return t=e.props,t}));const d=null===(i=null===(t=null==a?void 0:a.props)||void 0===t?void 0:t[0])||void 0===i?void 0:i.props.areSuggestionsGenerated;null===(n=this.copilotChatRef.current)||void 0===n||n.addResponseMessage({chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.ReviewStatusCard,reviewAgentInternalCardProps:r[0]}}},chatMessageBodyData:{messageId:B.get(S.I.ReviewStatusCard)},stopLoadingUi:!0}),d?this.setSuggestionList([b,"Show suggestions",U,O]):this.setSuggestionList([b,U,O]),Ne.log("ReviewerAgent:: processSummaryCard payload: ",a),Pe(this.telemetryLoggerUtils,$.ProcessSummaryCard,ee,null!==(o=this.agentID)&&void 0!==o?o:ee,null!==(s=this.agentStatus)&&void 0!==s?s:ee)}sendEventToClient(e,t){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var t,i;Ne.log("ReviewerAgent:: SendEventToClient.",e),e==m.PV.CopilotChatLoaded&&(this.invokeReviewAgent(),Pe(this.telemetryLoggerUtils,$.ChatPaneLoaded,"SendEventToClient",null!==(t=this.agentID)&&void 0!==t?t:ee,null!==(i=this.agentStatus)&&void 0!==i?i:ee))}))}invokeReviewAgent(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var e,t;(t=this.getDocumentSensitivity?yield this.getDocumentSensitivity():void 0)&&t.parent&&(ae.log("ReviewerAgent:: sensitivity: ",t),1)?null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:"chat",messageHeader:{text:"I'm sorry, but I can't assist you in initiating a review as this document is marked confidential. Please take a moment to review the sensitivity label and try again."}}},chatMessageBodyData:{actionButtonList:[Ae()]},stopLoadingUi:!0}):(Ne.log("ReviewerAgent:: Sending initial signal"),this.sendInitialSignal())}))}getDefaultSignalOperation(e,t,i,n,o){var s,a,r,d,l;let g;Ne.log("ReviewerAgent:: getDefaultSignalOperation.",e,t),Pe(this.telemetryLoggerUtils,$.DefaultSignalOperation,e,null!==(s=this.agentID)&&void 0!==s?s:ee,null!==(a=this.agentStatus)&&void 0!==a?a:ee);const u={documentConfig:{documentURL:this.documentURL}};var c;e.toLowerCase().includes("status")?(g=Object.assign(Object.assign({},(c=this.agentID,{query:"status review of agent",queryId:(0,se.A)(),agentId:c,summaryCardSignal:{agentId:c}})),{config:u}),null===(r=this.copilotChatRef.current)||void 0===r||r.updateLoadingComponentProps({loadingUiStringList:V})):e.toLowerCase().includes("close")?g=Object.assign(Object.assign({},le(this.agentID)),{config:u}):e.toLowerCase().includes("suggestion")?(g=Object.assign(Object.assign({},de(this.agentID)),{config:u}),null===(d=this.copilotChatRef.current)||void 0===d||d.updateLoadingComponentProps({loadingUiStringList:j})):e.toLowerCase().includes("start")?(g=Object.assign(Object.assign({},re({mail:this.authorMail,displayName:this.authorName})),{config:u}),null===(l=this.copilotChatRef.current)||void 0===l||l.updateLoadingComponentProps({loadingUiStringList:x})):g=Object.assign({},((e,t)=>{let i={query:e,queryId:(0,se.A)()};return t&&(i=Object.assign(Object.assign({},i),{agentId:t})),i})(e,this.agentID));const h={operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:Q.generateId(),body:new I(g)}]}),workflowAnnotationType:_.getTypeName()};return Promise.resolve(h)}getHostSettings(){return{appName:"Testing",appPlatform:"All",devBuild:!0,environment:m.DF.DEV,sessionId:"",augloopUrl:"http://localhost:20080"}}getAuthToken(){return Ne.log("ReviewerAgent:: getauthtoken"),Promise.resolve("")}shouldSendRequestToAugloop(e){var t,i,n,o,s,a,r,d;if(e.toLowerCase().includes(O.toLowerCase())){const s=new Set([ie.ACTIVE,ie.CRITICAL,ie.INACTIVE]);return Pe(this.telemetryLoggerUtils,$.SendRequestToAL,e,null!==(t=this.agentID)&&void 0!==t?t:ee,null!==(i=this.agentStatus)&&void 0!==i?i:ee),s.has(this.agentStatus)?(null===(n=this.copilotChatRef.current)||void 0===n||n.addResponseMessage({chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:S.I.EntryPointCard,reviewAgentInternalCardProps:{isTriggeredFromReviewerAgentPane:!0,isSecondHeaderHidden:!0,isIconHidden:!0,buttonLeftText:F,buttonRightText:"Cancel",reviewAgentDescriptionText:"Closing the review will end access to suggestions and summaries generated for this session. This action cannot be undone.",onAddDetailsButtonClick:()=>{Ne.log("Cancel button clicked for close agent reviewer"),this.setSuggestionList([b,U,O])},onStartReviewButtonClick:()=>{var e,t;null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:"human",messageHeader:{text:F}}},stopLoadingUi:!0}),null===(t=this.copilotChatRef.current)||void 0===t||t.startLoadingUi(),this.sendCloseAgentSignal(),this.setSuggestionList([])}}}}}}),this.setSuggestionList([b,U])):(null===(o=this.copilotChatRef.current)||void 0===o||o.addResponseMessage(this.getPlainTextChatCardResponse("Unable to close review at this moment.")),this.setSuggestionList([b,U])),Promise.resolve(!1)}if(e.toLowerCase().includes(b.toLowerCase())){if(new Set([ie.ACTIVE,ie.INACTIVE,ie.CRITICAL]).has(this.agentStatus)){const e=null===(a=null===(s=this.confirmInvitationCardProps)||void 0===s?void 0:s.individualComponentPropsMap)||void 0===a?void 0:a[y.T.SUBMIT];e&&(e.isFormReadyForSubmission=this.validateBeforeSubmit()),null===(r=this.copilotChatRef.current)||void 0===r||r.addResponseMessage(this.getConfirmInvitationCardResponseMessage()),this.setSuggestionList([U,O])}else null===(d=this.copilotChatRef.current)||void 0===d||d.addResponseMessage(this.getPlainTextChatCardResponse("Unable to edit review details at this moment.")),this.setSuggestionList([U,O]);return Promise.resolve(!1)}return Promise.resolve(!0)}getALSession(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){if(Ne.log("getALSession"),this.session)return this.session;throw new Error("Session is not undefined")}))}sendInitialSignal(){var e,t,i,n,o;Ne.log("sendInitialSignal"),Pe(this.telemetryLoggerUtils,$.SendInitialSignal,ee,null!==(e=this.agentID)&&void 0!==e?e:ee,null!==(t=this.agentStatus)&&void 0!==t?t:ee);const s={documentConfig:{documentURL:this.documentURL}},a=Object.assign(Object.assign({},re({mail:this.authorMail,displayName:this.authorName})),{config:s});null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:Q.generateId(),body:new I(a)}]}),workflowAnnotationType:_.getTypeName()}),null===(n=this.copilotChatRef.current)||void 0===n||n.startLoadingUi(),null===(o=this.copilotChatRef.current)||void 0===o||o.updateLoadingComponentProps({loadingUiStringList:x})}sendCloseAgentSignal(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var e,t,i,n;Ne.log("sendCloseAgentSignal"),Pe(this.telemetryLoggerUtils,$.SendCloseAgentSignal,ee,null!==(e=this.agentID)&&void 0!==e?e:ee,null!==(t=this.agentStatus)&&void 0!==t?t:ee);const o={documentConfig:{documentURL:this.documentURL}},s=Object.assign(Object.assign({},le(this.agentID)),{config:o});null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:Q.generateId(),body:new I(s)}]}),workflowAnnotationType:_.getTypeName()}),null===(n=this.copilotChatRef.current)||void 0===n||n.updateLoadingComponentProps({loadingUiStringList:W})}))}getUpdatedReviewDetailsData(){var e,t,i,n,o,s,a,r,d;let l={};const g=null===(t=null===(e=this.returningUserReviewDetailsProps)||void 0===e?void 0:e.individualComponentPropsMap)||void 0===t?void 0:t[y.T.DATE_PICKER];"string"==typeof(null==g?void 0:g.selectedDate)&&(g.selectedDate=new Date(g.selectedDate));const u=null===(i=null==g?void 0:g.selectedDate)||void 0===i?void 0:i.getTime();this.date!==u&&(l=Object.assign(Object.assign({},l),{DUE_DATE:this.date}));const c=(null===(s=null===(o=null===(n=this.returningUserReviewDetailsProps)||void 0===n?void 0:n.individualComponentPropsMap)||void 0===o?void 0:o[y.T.DROP_DOWN])||void 0===s?void 0:s.selectedValue)||te.NONE;De(this.reminder,c)&&(l=Object.assign(Object.assign({},l),{REMINDER_CADENCE:this.reminder}));const h=(null===(d=null===(r=null===(a=this.returningUserReviewDetailsProps)||void 0===a?void 0:a.individualComponentPropsMap)||void 0===r?void 0:r[y.T.PEOPLE_PICKER])||void 0===d?void 0:d.suggestions)||[],p=this.reviewers.filter((e=>!h.some((t=>e.mail===t.mail))));return p.length&&(l=Object.assign(Object.assign({},l),{REVIEWERS:p.map((e=>Object.assign(Object.assign({},e),{commentId:this.commentId,context:this.message})))})),l}getUIStateSyncData(){if(this.isReturningUser){return this.getUpdatedReviewDetailsData()}return{INVITE_EMAIL:this.message,DUE_DATE:this.date,FAST_MODE_ENABLED:this.isFastModeReviewerAgentEnabled,REMINDER_CADENCE:this.reminder,REVIEWERS:this.reviewers.map((e=>Object.assign(Object.assign({},e),{commentId:this.commentId,context:this.message}))),AUTHOR:{displayName:this.authorName,mail:this.authorMail}}}sendUIStateSyncSignal(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var e,t,i,n,o,s;this.reviewers.length>0&&(yield this.notifyClientOnReviewInitiation()),this.confirmInvitationCardProps.isCardSubmitted=!0,this.confirmInvitationCardProps.individualComponentPropsMap[y.T.SUBMIT].isFormReadyForSubmission=!1,null===(e=this.copilotChatRef.current)||void 0===e||e.updateMessage(this.getConfirmInvitationCardResponseMessage()),Ne.log("sendUIStateSyncSignal"),Pe(this.telemetryLoggerUtils,$.SendUIStateSyncSignal,ee,null!==(t=this.agentID)&&void 0!==t?t:ee,null!==(i=this.agentStatus)&&void 0!==i?i:ee);const a=this.getUIStateSyncData(),r={documentConfig:{documentURL:this.documentURL}},d=Object.assign(Object.assign({},ge(a,this.agentID)),{config:r});null===(n=this.copilotChatRef.current)||void 0===n||n.startLoadingUi(),null===(o=this.copilotChatRef.current)||void 0===o||o.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:Q.generateId(),body:new I(d)}]}),workflowAnnotationType:_.getTypeName()}),null===(s=this.copilotChatRef.current)||void 0===s||s.updateLoadingComponentProps({loadingUiStringList:H}),this.setSuggestionList([U,O])}))}validateBeforeSubmit(){if(this.isReturningUser){const e=this.getUpdatedReviewDetailsData(),t=e.DUE_DATE&&e.DUE_DATE>Date.now(),i=e.REVIEWERS&&e.REVIEWERS.length;return!(!t&&!i)}return this.message.length>0&&this.date>Date.now()}sendUIStateSyncSignalZeroReviewers(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var e,t,i;Ne.log("sendUIStateSyncSignalZeroReviewers"),Pe(this.telemetryLoggerUtils,$.SendUIStateSyncSignalZeroReviewers,ee,null!==(e=this.agentID)&&void 0!==e?e:ee,null!==(t=this.agentStatus)&&void 0!==t?t:ee);const n=new Date;n.setDate(n.getDate()+7);const o={INVITE_EMAIL:"",DUE_DATE:n.getTime(),REMINDER_CADENCE:"1 day before",REVIEWERS:[],AUTHOR:{displayName:this.authorName,mail:this.authorMail}},s={documentConfig:{documentURL:this.documentURL}},a=Object.assign(Object.assign({},ge(o,this.agentID)),{config:s});Ne.log("sendUIStateSyncSignalZeroReviewers textTile",a),null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:Q.generateId(),body:new I(a)}]}),workflowAnnotationType:_.getTypeName()}),this.setSuggestionList([U,O])}))}notifyClientOnReviewInitiation(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){const e=`[via Reviewer]\n\nHello ${this.reviewers.map((e=>e.displayName)).join(", ")}\n\nHere's how you can help with this document review:\n"${this.message}"`;Ne.log(e),this.commentId=yield this.addCommentToFirstLineOfDocument(null!=e?e:"Please review this document",this.commentId)}))}showActionCard(e){this.copilotChatRef.current.addResponseMessage({chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:R.Q9.Human,messageHeader:{text:e}}}})}removeActionButtonFromLastCard(){this.copilotChatRef.current.updateLastMessage({chatCardType:p._.Default,chatMessageBodyData:{actionButtonList:[]},addCardToChatHistory:!1})}sendSuggestionActionSignal(e,t){var i;Te("sendSuggestionActionSignal");const n={documentConfig:{documentURL:this.documentURL}},o=Object.assign(Object.assign({},((e,t,i,n)=>({query:"suggestion applied",queryId:(0,se.A)(),agentId:e,suggestionActionSignal:{agentId:e,commentId:t,changeType:i,isValid:n}}))(this.agentID,e,t,!1)),{config:n});null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.getTypeName()],items:[{id:Q.generateId(),body:new I(o)}]}),workflowAnnotationType:_.getTypeName()})}}var Ue=i(58651);const Oe=(e,t)=>{Ue.log("onAgentToggleChangeStub")},be=(e,t,i)=>{Ue.log("onApplySuggestionStub: ",e,t,i)},Fe=e=>{Ue.log("onSuggestionCardNavigationStub: ",e)},ke=e=>(Ue.log("addCommentToFirstLineOfDocument: ",e),Promise.resolve("Comment added successfully")),Be={themePrimary:"#598FEC",themeSecondary:"#8763c2",themeLight:"#0E336A",themeDark:"#464FEB",themeTertiary:"#598FEC",themeDarker:"#353696",themeMedium:"#464FEB",themeDarkAlt:"#3D91FF",themeLighterAlt:"#6CEBE2",themeLighter:"#9270FF",neutralPrimary:"#FFFFFF",neutralLight:"#292929",neutralLighter:"#757575",neutralLighterAlt:"#666666",neutralSecondaryAlt:"#FFFFFF",neutralTertiary:"#3D3D3D",neutralTertiaryAlt:"#3D3D3D",neutralQuaternaryAlt:"#FFFFFF",neutralDark:"#2461CA",black:"#FFFFFF",white:"#000000"},xe={themePrimary:"#185abd",themeSecondary:"#8763c2",themeLight:"#D2E0F4",themeDark:"#82ABF1",themeTertiary:"#598FEC",themeDarker:"#598FEC",themeMedium:"#82ABF1",themeDarkAlt:"#3D91FF",themeLighterAlt:"#6CEBE2",themeLighter:"#9270FF",neutralLighter:"#f5f5f5",neutralDark:"#1651AA",white:"#FFFFFF"};var He=i(60195),Ve=i(81783);const je=(0,He.n)((0,Ve.f)({chatFreStack:{height:"calc(100vh - 50px)"},chatUiStack:{top:"20px"}}));var We=i(58651);const qe=({isTestApp:e=!1,copilotTelemetryHandler:t,alSession:n,documentURL:o,userQuery:s,onReviewerAgentToggleChange:a,onApplySuggestion:r,addCommentToFirstLineOfDocument:h,onSuggestionCardNavigation:p,peoplePickerEditorConfig:v,isDarkModeEnabled:C=!1,isHighContrastModeEnabled:m=!1,authorName:R,authorEmail:y,isReviewerNotAddedButtonClicked:S=!1,agentLaunchType:f=K.LAUNCH_WITH_REVIEWERS,getDocumentSensitivity:A,isReviewerToggleEnabled:I=!1})=>{We.log("ReviewerAgent: ",n,"IsTestApp: ",e);const T=c.useRef(null),[w,E]=(0,c.useState)([]);(0,c.useEffect)((()=>{}),[w]);const _=(e,t,i)=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){We.log("ReviewerAgent:: onApplySuggestionsCbk: ",e,t,i),r&&(yield r(e,t,i))})),D=e=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){We.log("ReviewerAgent:: onSuggestionCardNavigationStubCbk: ",e);const t=parseInt(e,16);yield p(t.toString())}));e&&(s="create agent",o="https://www.microsoft.com",R="Aditya Test",y="test@msft.com");const L=Me.getInstance(T,e?void 0:n,s,o,R,y,E,S,f,A,v);e?L.setCallbacks(be,Oe,ke,Fe):L.setCallbacks(_,a,h,D);const P={settings:{hostAppId:"Word_Online",hostAppName:"Word",hostAppPlatform:"Web",hostAppScenario:"Copilot",hostDefaultLocale:"en-US",isDogfoodEnvironment:!0,resultTime:1e4},telemLogger:{logError:e=>{We.log("Shared Copilot CIQ Error Log: ",e)}},entitiesSupported:[],isExpandedECCEnabled:!1},N={headerText:"Reviewer",descriptionText:"I'm the ultimate partner for document reviews, and can help you launch, track progress and resolve review comments.",freImagePath:i(96193),hideGetStartedButton:!0},[M,U]=c.useState(!1),O={trySydneyToggleChecked:!1,trySydneyToggleEnabled:!1,tryWebSearchToggleEnabled:!1,trySydneyToggleOnChange:(e,t)=>{We.log("officeaicopilot-test-app: onChange for Try Sydney Toggle")},tryEnterpriseSearchToggleChecked:!1,tryEnterpriseSearchToggleEnabled:!1,tryEnterpriseSearchToggleOnChange:(e,t)=>{We.log("officeaicopilot-test-app: onChange for Enterprise Search Toggle")},tryReviewerAgentToggleChecked:!0,tryReviewerAgentToggleEnabled:I,tryReviewerAgentToggleOnChange:a,FastModeReviewerAgentToggleChecked:M,FastModeReviewerAgentToggleEnabled:L.getAgentStatus()===ie.INIT,FastModeReviewerAgentToggleOnChange:(e,t)=>{const i=!M;L.setFastModeReviewerAgentEnabled(i),U(i)}},b=je(),F=((e,t)=>Object.assign({isDarkModeEnabled:e,isHighContrastModeEnabled:t},e?Be:xe))(C,m);return(0,c.useEffect)((()=>(l.j.setTelemetryHandler(t),()=>{Me.destroy()})),[]),c.createElement(u.B,{className:"ms-welcome",style:{display:"flex",gap:"8px",margin:"0px 4px"}},e||n?c.createElement(g.zn,{style:b,chatUiProps:{chatInputV2Props:{pluginsInfo:[],chatPlaceholderMessage:"Type a message for Reviewer",editorConfig:P},changeTopicUiProps:{hideChangeTopicButton:!0},freUiProps:N,toggleUiProps:O,suggestionPillsUiProps:{suggestionList:w}},copilotCommunicationHandler:L,useALRuntime:!!e,copilotTelemetryHandler:t,ref:T,theme:F}):c.createElement("div",null,"ReviewerAgent: alSession is required for non test"))};qe.displayName="Reviewer"},77784:(e,t,i)=>{var n;i.d(t,{I:()=>n}),function(e){e.EntryPointCard="EntryPointCard",e.ConfirmInvitationCard="ConfirmInvitationCard",e.SuggestionCard="SuggestionCard",e.ReviewStatusCard="ReviewStatusCard"}(n||(n={}))},80766:(e,t,i)=>{var n;i.d(t,{T:()=>n}),function(e){e.PEOPLE_PICKER="PEOPLE_PICKER",e.TEXT_AREA="TEXT_AREA",e.DATE_PICKER="DATE_PICKER",e.DROP_DOWN="DROP_DOWN",e.SUBMIT="SUBMIT"}(n||(n={}))},96193:(e,t,i)=>{e.exports=i.p+"assets/fre-reviewer-agent-illustration.svg"}}]);
//# sourceMappingURL=vendors~ReviewerAgent.js.map