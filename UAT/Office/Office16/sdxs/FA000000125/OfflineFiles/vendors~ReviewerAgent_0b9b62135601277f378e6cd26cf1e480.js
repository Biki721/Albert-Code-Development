"use strict";(self.webpackChunkTypeScriptModule=self.webpackChunkTypeScriptModule||[]).push([[7410],{744601:(e,t,i)=>{i.r(t),i.d(t,{ReviewerAgent:()=>$e,ReviewerAgentLaunchType:()=>ie});var n,s,o,a,r,d=i(123182),l=i(341148),g=i(984443),u=i(876355),c=i(208520),h=i(957866),p=i(36072),v=i(640769),C=i(554858),m=i(378986),R=i(89169),S=i(823479),f=i(917617),I=i(137367),y=i(818980);!function(e){e.CREATE="CREATE",e.RETURNINGUSER="RETURNINGUSER",e.NONE="NONE"}(n||(n={})),function(e){e.CUSTOMCARD="CustomCard",e.CHATCARD="ChatCard",e.SUMMARYCARD="SummaryCard",e.SUGGESTIONCARD="SuggestionCard"}(s||(s={})),function(e){e[e.VARIABLE=0]="VARIABLE",e[e.CONFIG=1]="CONFIG"}(o||(o={})),function(e){e.Insert="Insert",e.Rewrite="Rewrite",e.Reply="Reply"}(a||(a={})),function(e){e.PROJECTS="PROJECTS",e.QUERIES="QUERIES"}(r||(r={}));var w=i(724582),E=i(53122),T=i(76041),A=i(376035),D=i(36733),_=i(469532),P=i(291108),L=i(603471),b=(0,d.__assign)((0,d.__assign)((0,d.__assign)((0,d.__assign)({color:D.L.colorNeutralForeground4,alignItems:"flex-start"},_.g.body1),{fontStyle:"normal"}),P.Pt.gap("1px")),{content:"attr(title)"}),N={color:D.L.colorNeutralForegroundDisabled,"@media (forced-colors: active)":{forcedColorAdjust:"none"}},U=(0,d.__assign)((0,d.__assign)((0,d.__assign)((0,d.__assign)({},_.g.body1),{alignItems:"flex-start",fontStyle:"normal"}),P.Pt.gap("1px")),{whiteSpace:"pre-wrap",display:"inline-block",width:"100%","&:focus":(0,d.__assign)({},P.Pt.outline(0))}),M={userInput:(0,d.__assign)((0,d.__assign)({},U),{"&:focus":(0,d.__assign)({},P.Pt.outline(0)),"&:focus::after":b,"&::after":b})},O={userInput:(0,d.__assign)((0,d.__assign)({},U),{"&:focus":(0,d.__assign)({},P.Pt.outline(0))})},k={userInput:{"&:focus::after":N,"&::after":N}},F=((0,L.n)(O),(0,L.n)(M)),x=(0,L.n)(k),B=i(758651),H=function(e){var t=e.isDisabled,i=void 0!==t&&t,n=e.placeholderText,s=void 0===n?"":n,o=e.editorProps,a=e.onItemSelected,r=e.overrideStyles,l=e.startInMenuOpenState,g=e.queryCharToUse,u=null!=g?g:E.O8,h=c.useRef(),p=(0,c.useRef)(!0),v=(0,d.__read)(c.useState(void 0),2),C=v[0],m=v[1],R=(0,c.useRef)(null),S=(0,d.__read)((0,c.useState)(void 0),2),f=S[0],I=S[1],y=(0,d.__read)((0,c.useState)(s),2),w=y[0],D=y[1],_=c.useCallback((function(){var e,t,n,s;if(!i&&(null==o?void 0:o.handleInChatInput)&&(null==o?void 0:o.editorConfig)&&!h.current&&(null==o?void 0:o.alSession)){if(!p.current)return null===(t=null===(e=null==o?void 0:o.editorConfig)||void 0===e?void 0:e.telemLogger)||void 0===t||t.logSuccessTelemetry("Editor_Bootstrap_Skipped","ShouldBootStrapEditor is false"),void B.log("EditorBootstrapping is skipped as shouldBootStrapEditor is false");var a=(new T.V).createInstance();p.current=!1,a.bootstrap((n=o.editorConfig,s=o.alSession,(0,d.__assign)((0,d.__assign)({},n),{augloopSession:s}))).then((function(e){h.current=a,m(e)}))}}),[null==o?void 0:o.alSession,null==o?void 0:o.handleInChatInput,null==o?void 0:o.editorConfig,i]);(0,c.useEffect)((function(){_()}),[_]),(0,c.useEffect)((function(){return function(){h.current&&(h.current.shutdown(),h.current=void 0,m(void 0),I(void 0),p.current=!0)}}),[null==o?void 0:o.alSession,null==o?void 0:o.handleInChatInput,null==o?void 0:o.editorConfig]),(0,c.useEffect)((function(){if((null==o?void 0:o.handleInChatInput)&&(null==o?void 0:o.editorConfig)&&!f&&C&&R.current){var t=C.initializeCiq(R.current,{menuTitle:null==o?void 0:o.editorConfig.transformFileMenuTitle,menuSubtitle:(null==o?void 0:o.editorConfig.transformFilePlaceholderText)?null==o?void 0:o.editorConfig.transformFilePlaceholderText:"",queryCharToUse:u,getLocalItems:e.getLocalItems,onItemSelected:function(e){return(0,d.__awaiter)(void 0,void 0,void 0,(function(){return(0,d.__generator)(this,(function(t){return B.log(e),a&&a(e.suggestion),B.log("Item Selected"),o.postCIQItemSelectionHandler&&o.postCIQItemSelectionHandler(e.suggestion),[2]}))}))},entitiesEnabled:null==o?void 0:o.editorConfig.entitiesSupported,ExpanededECC:null==o?void 0:o.editorConfig.isExpandedECCEnabled});I(t)}}),[C,f]);var P=(0,c.useRef)(x()),L=(0,c.useRef)(F()),b=(0,d.__read)((0,c.useState)(L.current.userInput),2),N=b[0],U=b[1];(0,c.useEffect)((function(){i&&U((0,A.z)(L.current.userInput,P.current.userInput))}),[i]),(0,c.useEffect)((function(){var e=R.current;l&&C&&e&&f&&(e.innerText=u,e.focus(),e.lastChild?window.getSelection().setPosition(e.lastChild,e.lastChild.textContent.length):e.firstChild&&window.getSelection().setPosition(e.firstChild,e.firstChild.textContent.length),C.forceInvokeCIQMenu(u))}),[R.current,l,C,f]);return c.createElement("span",{className:N,title:w,ref:R,contentEditable:!0,onInput:function(e){""===e.target.textContent?D(s):e.target.textContent.length>0&&""!==w&&D("")},style:r})};const j="Done! Your review has been started. Feel free to ask me for a status update at any time.",V="Check review status",q="Close this review",W="Edit review details",G="Confirm",J="Something went wrong while executing this request",Q=new Map([[f.I.EntryPointCard,"ReviewAgentEntryPointCard"],[f.I.ConfirmInvitationCard,"ReviewAgentConfirmInvitationCard"],[f.I.ReviewStatusCard,"ReviewAgentReviewStatusCard"],[f.I.SuggestionCard,"ReviewAgentSuggestionsCard"]]),Y=["Retrieving session information...","Checking for active reviews...","Setting up context..."],K=["Processing your request...","Setting up due date & reminders....","Notifying your reviewers...."],X=["Updating reviewer counts...","Analyzing recent comments...","Compiling feedback..."],Z=["Processing feedback...","Generating actionable suggestions...","Creating a prioritized list..."],$=["Terminating active processes...","Clearing review data...","Finalizing review closure..."],z="https://microsoft.sharepoint-df.com/:w:/t/PPTOFastFoodTest/EX7Rw-e3ymlAmYUT6BVj12kBd9VTzVczouXYlEsewBGZsg?e=o2Fb5X",ee="Retry",te=864e5;var ie;!function(e){e.LAUNCH_WITH_REVIEWERS="LAUNCH_WITH_REVIEWERS",e.LAUNCH_WITHOUT_REVIEWERS="LAUNCH_WITHOUT_REVIEWERS",e.LAUNCH_FROM_TOGGLE="LAUNCH_FROM_TOGGLE"}(ie||(ie={}));class ne{static generateId(){return ne.operationId++,"AugLoopChatAgent-Reviewer"+ne.operationId.toString()}}var se,oe,ae,re,de;ne.operationId=0,function(e){e.Client="Client",e.Server="Server"}(se||(se={})),function(e){e.ErrorMessage="ErrorMessage",e.ErrorCode="ErrorCode",e.ErrorType="ErrorType",e.ErrorCategory="ErrorCategory"}(oe||(oe={})),function(e){e.ReviewerAgentPeoplePickerEditorConfigNotProvided="people-picker-editor-config-not-provided"}(ae||(ae={})),function(e){e.AgentCreated="Agent_Created",e.AgentClosed="Agent_Closed",e.AgentStatusChanged="Agent_Status_Changed",e.WorkflowRegisterd="Workflow_Registered",e.AddDetailsButtonClicked="Add_Details_Button_Clicked",e.StartReviewButtonClicked="Start_Review_Button_Clicked",e.SendResponseToClient="Send_Response_To_Client",e.ChatPaneLoaded="Chat_Pane_Loaded",e.DefaultSignalOperation="Default_Signal_Operation",e.SendRequestToAL="Send_Request_To_AL",e.SendInitialSignal="Send_Initial_Signal",e.SendCloseAgentSignal="Send_Close_Agent_Signal",e.SendUIStateSyncSignal="Send_UI_State_Sync_Signal",e.SendUIStateSyncSignalZeroReviewers="Send_UI_State_Sync_Signal_Zero_Reviewers",e.InvitationRenderCardRequest="Invitation_Render_Card_Request",e.ProcessSummaryCard="Process_Summary_Card"}(re||(re={})),function(e){e.AgentId="AgentId",e.AgentStatus="AgentStatus",e.AgentEventType="AgentEventType",e.AgentEventParameters="AgentEventParameters"}(de||(de={}));const le="";var ge,ue;!function(e){e.NONE="None",e.ONE_DAY_BEFORE="1 day before",e.THREE_DAYS_BEFORE="3 days before"}(ge||(ge={})),function(e){e.INIT="Init",e.COMPLETED="Completed",e.CRITICAL="Critical",e.ACTIVE="Active",e.INACTIVE="Inactive",e.FAILED="Failed",e.EXPIRED="Expired"}(ue||(ue={}));var ce=i(121063),he=i(759801),pe=i(298483),ve=i(758651);const Ce=({displayName:e,mail:t})=>({query:"create agent",queryId:(0,pe.A)(),createAgent:{templateName:"ReviewSync",mode:n.CREATE,propValues:JSON.stringify({AUTHOR:{displayName:e,mail:t}})}}),me=e=>({query:"Show Suggestion",queryId:(0,pe.A)(),agentId:e,suggestionCardSignal:{agentId:e}}),Re=e=>({query:"clean up agent",agentId:e,queryId:(0,pe.A)(),cleanupSignal:{agentId:e}}),Se=(e,t)=>{const i=JSON.stringify(e);return{query:"UI STATE SYNC",queryId:(0,pe.A)(),agentId:t,uiStateSync:{jsonPayload:i}}},fe=e=>{const t=JSON.parse(e);return t?t.mode:n.NONE},Ie=e=>{var t;const i=null===(t=JSON.parse(e))||void 0===t?void 0:t.payload;return i?i.agentId:""},ye=(e,t)=>{var i,n;const s=null===(i=JSON.parse(e))||void 0===i?void 0:i.payload,o=null!==(n=null==s?void 0:s.agentStatus)&&void 0!==n?n:"";return""===o?t:o},we=(e,t="Hello, welcome back. How can I help you today?")=>{var i;let n;try{n=null===(i=JSON.parse(e))||void 0===i?void 0:i.payload}catch(t){ve.log("Error in parsing payload",t),ve.log("Response message",e)}return n?n.displayMessage:t},Ee=e=>{var t;let i;try{i=null===(t=JSON.parse(e))||void 0===t?void 0:t.payload}catch(t){ve.log("Error in parsing payload",t),ve.log("Response message",e)}return ve.log("ReviewerAgent:: payload: ",i),i},Te=e=>void 0!==JSON.parse(e).uiType,Ae=e=>JSON.parse(e).uiType;function De(e){if(e instanceof Date)return e;const t="string"==typeof e?parseInt(e):e;return new Date(t)}function _e(e){const t=e.trim(),i=Number(t);if(isNaN(i))return NaN;const n=parseInt(t,10);return i===n?n:NaN}function Pe(e={}){var t;const i={};for(const n in e.props||{})i[n]=null===(t=e.props[n])||void 0===t?void 0:t.defaultValue;return i}const Le=(e,t=!1)=>{const i={};for(const n of e)if(n)switch(n.kind){case S.T.DATE_PICKER:{const e=Pe(n);if(t)e.selectedDate=De(e.selectedDate);else{const t=new Date;t.setDate(t.getDate()+7),0===t.getDay()?t.setDate(t.getDate()+1):6===t.getDay()&&t.setDate(t.getDate()+2),e.selectedDate=t}i[S.T.DATE_PICKER]=e}break;case S.T.TEXT_AREA:{const e=Pe(n);i[S.T.TEXT_AREA]=e}break;case S.T.PEOPLE_PICKER:{const e=Pe(n);i[S.T.PEOPLE_PICKER]=e}break;case S.T.DROP_DOWN:{const e=Pe(n);if(e.displayValue=ge.NONE,t){if(e.selectedValue=e.selectedValue||ge.NONE,e.selectedValue!==ge.NONE)if(isNaN(_e(e.selectedValue)))e.selectedValue=ge.NONE,e.displayValue=ge.NONE;else{const t=new Date(parseInt(e.selectedValue)).toDateString();e.displayValue=t}}else e.selectedValue=ge.NONE;i[S.T.DROP_DOWN]=e}break;case S.T.SUBMIT:{const e=Pe(n);i[S.T.SUBMIT]=e}break;default:throw new Error(`Unsupported kind: ${n.kind}`)}return i};function be(e=Ne){return{type:ce.j.Default,title:ee,text:ee,iconRegular:he.DXr,iconHover:he.fC9,handleButtonOnClick:e}}const Ne=(e,t,i)=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){Ue("Retry button clicked"),je.getInstance().removeActionButtonFromLastCard(),je.getInstance().showActionCard(ee),yield je.getInstance().invokeReviewAgent()})),Ue=(...e)=>{ve.log("ReviewerAgent::"+(new Date).toUTCString(),...e)},Me=e=>{const t=[],i=new Date;for(const n in ge){let s=new Date(e),o=0;switch(ge[n]){case ge.ONE_DAY_BEFORE:o=1;break;case ge.THREE_DAYS_BEFORE:o=3;break;case ge.NONE:t.push(ge.NONE);break;default:continue}const a=s.getTime()-o*te;if(o>0&&a>=i.getTime()){s=new Date(a);const e=s.toLocaleDateString(),i=`${ge[n]} (${e})`;t.push(i)}}return t};function Oe(e,t,i){return(0,d.__awaiter)(this,void 0,void 0,(function*(){Ue("ReviewerAgent:: suggestionCallback called"),yield je.getInstance().onApplySuggestion(e,t,i),yield je.getInstance().sendSuggestionActionSignal(e,i)}))}function ke(e){Ue("ReviewerAgent:: suggestion navigation clickedcalled"),je.getInstance().onSuggestionCardNavigation(e)}function Fe(e,t){if("None"!==e&&"None"!==t){return 0!==function(e,t){const i=xe(e),n=xe(t),s=(i-n)/te;return Math.floor(Math.abs(s))}(e,t)}return e!==t}function xe(e){let t;if(!(e instanceof Date)){const i=Number(e);t=isNaN(i)?new Date(e):new Date(i)}const i=t.getTime();if(isNaN(i))throw new Error(`Provided date ${e} is invalid`);return i}function Be(e,t,i,n,s){e.sendTelemetryAgentEventData([{key:de.AgentEventType,value:t},{key:de.AgentEventParameters,value:i},{key:de.AgentId,value:n},{key:de.AgentStatus,value:s}])}var He=i(758651);class je extends h.h{sendSuggestionSignal(){var e,t,i;null===(e=this.copilotChatRef.current)||void 0===e||e.addChatMessages([{messageType:p._.ChatCardWrapper,body:{user:"human",element:"Show Suggestions"}}]);const n={documentConfig:{documentURL:this.documentURL}},s=Object.assign(Object.assign({},me(this.agentID)),{config:n});null===(t=this.copilotChatRef.current)||void 0===t||t.submitOperation({operation:new v.g0({parentPath:["Signal",I.br.getTypeName()],items:[{id:ne.generateId(),body:new I.br(s)}]}),workflowAnnotationType:y.xj.getTypeName()}),null===(i=this.copilotChatRef.current)||void 0===i||i.startLoadingUi()}constructor(e,t,i,n,s,o,a,r,d,g,u){super(),this.commentId="",this.documentURL=z,this.userQuery="",this.authorName="",this.authorMail="",this.message="",this.date=null,this.reminder="",this.agentID="",this.agentStatus=ue.INIT,this.isInitialCardShown=!1,this.isReturningUser=!1,this.firstMessageText="",this.annotationId=void 0,this.telemetryLoggerUtils=l.j.getInstance(),this.agentLaunchType=ie.LAUNCH_WITH_REVIEWERS,this.processInvitationRenderCardRequest=e=>{var t,i,n,s,o;He.log("ReviewerAgent::  processInvitationRenderCardRequest response ",e);const a=Ee(e);He.log("ReviewerAgent::  processInvitationRenderCardRequest payload ",a);const r=(null==a?void 0:a.props)||(null===(t=null==a?void 0:a.additionalPayload)||void 0===t?void 0:t.props)||{},d=(null==r?void 0:r.headerText)||(null===(i=null==a?void 0:a.additionalPayload)||void 0===i?void 0:i.headerText);He.log("ReviewerAgent::  processInvitationRenderCardRequest payload.props ",r);const l=function(e){let t=(0,pe.A)();return t=e?`EditReviewDetails-${t}`:`${Q.get(f.I.ConfirmInvitationCard)}-${t}`,t}(this.isReturningUser);this.confirmInvitationCardProps={headerText:d,individualComponentPropsMap:Le(r,this.isReturningUser),messageId:l},this.isReturningUser?this.returningUserReviewDetailsProps=JSON.parse(JSON.stringify(this.confirmInvitationCardProps)):this.returningUserReviewDetailsProps=void 0;const g=this.confirmInvitationCardProps.individualComponentPropsMap[S.T.PEOPLE_PICKER],u=this.confirmInvitationCardProps.individualComponentPropsMap[S.T.TEXT_AREA],h=this.confirmInvitationCardProps.individualComponentPropsMap[S.T.DATE_PICKER],p=this.confirmInvitationCardProps.individualComponentPropsMap[S.T.DROP_DOWN],v=this.confirmInvitationCardProps.individualComponentPropsMap[S.T.SUBMIT];var m,R,I,y,w;this.reviewers=[],g&&(Array.isArray(g.suggestions)||(g.suggestions=(null===(n=g.suggestions)||void 0===n?void 0:n.value)||[]),this.isReturningUser?(g.suggestions.forEach((e=>{e.isReadOnly=!0})),this.reviewers=g.suggestions):g.suggestions=this.reviewers,this.peoplePickerEditorConfig||(He.error("ReviewerAgent::  processInvitationRenderCardRequest peoplePickerEditorConfig is not provided"),m=this.telemetryLoggerUtils,R="ReviewerAgent::  processInvitationRenderCardRequest peoplePickerEditorConfig is not provided",I=se.Server,y=ae.ReviewerAgentPeoplePickerEditorConfigNotProvided,w=C.S2.Error,m.sendTelemetryAgentErrorData([{key:oe.ErrorMessage,value:R},{key:oe.ErrorType,value:I},{key:oe.ErrorCode,value:y},{key:oe.ErrorCategory,value:w}])),g.inputComponent=((e,t,i)=>{let n;return i&&(n={editorConfig:i,alSession:e,handleInChatInput:!0}),c.createElement(H,{editorProps:n,placeholderText:"Type / to add reviewers",onItemSelected:t})})(this.session,this.onItemSelected,this.peoplePickerEditorConfig),g.onPeopleRemoved=e=>{var t;this.reviewers=this.reviewers.filter((t=>t.mail!==e.mail)),g.suggestions=this.reviewers,this.isReturningUser&&v&&(v.isFormReadyForSubmission=this.validateBeforeSubmit()),null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage())}),u&&(this.message=u.message,u.onMessageChange=e=>{var t;He.log("ReviewerAgent::  onMessageChange message ",e),this.message=e,(0===this.message.trim().length||this.message.trim().length>0&&v&&!v.isFormReadyForSubmission)&&(v.isFormReadyForSubmission=this.validateBeforeSubmit(),null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage()))}),h&&(this.date=h.selectedDate.getTime(),h.onDateChange=e=>{var t;He.log("ReviewerAgent::  onDateChange date ",e),e.setHours(23,59,59,999),this.date=e.getTime(),this.reminder=ge.NONE,p&&(p.selectedValue=this.reminder,p.displayValue=this.reminder,p.options=Me(this.date)),v&&(v.isFormReadyForSubmission=this.validateBeforeSubmit()),null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage())}),p&&(this.date&&(p.options=Me(this.date)),this.reminder=p.selectedValue,p.onItemSelected=e=>{var t;if(He.log("ReviewerAgent::  onDateChange item ",e),e.includes("1 day")){const e=this.date-864e5;this.reminder=e.toString()}else if(e.includes("3 days")){const e=this.date-2592e5;this.reminder=e.toString()}else{const t=new Date(e);isNaN(t.getTime())?this.reminder=e:this.reminder=new Date(e).toString()}v&&(v.isFormReadyForSubmission=this.validateBeforeSubmit()),p.selectedValue=this.reminder,p.displayValue=e,null===(t=this.copilotChatRef.current)||void 0===t||t.updateMessage(this.getConfirmInvitationCardResponseMessage())}),v&&(v.onSubmit=()=>this.sendUIStateSyncSignal()),He.log("ReviewerAgent::  processInvitationRenderCardRequest this.confirmInvitationCardProps: ",this.confirmInvitationCardProps),this.isReturningUser||this.agentLaunchType!==ie.LAUNCH_WITH_REVIEWERS||this.showInvitationCard(),Be(this.telemetryLoggerUtils,re.InvitationRenderCardRequest,le,null!==(s=this.agentID)&&void 0!==s?s:le,null!==(o=this.agentStatus)&&void 0!==o?o:le)},this.showInvitationCard=()=>{var e;this.confirmInvitationCardProps.individualComponentPropsMap[S.T.SUBMIT].isFormReadyForSubmission=this.validateBeforeSubmit(),null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage(this.getConfirmInvitationCardResponseMessage())},this.getConfirmInvitationCardResponseMessage=()=>{const e=this.confirmInvitationCardProps.messageId||Q.get(f.I.ConfirmInvitationCard);return{chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:f.I.ConfirmInvitationCard,reviewAgentInternalCardProps:this.confirmInvitationCardProps}}},chatMessageBodyData:{messageId:e}}},this.onItemSelected=e=>{var t,i,n;const s={displayName:e.text,mail:e.id};if(!this.reviewers.find((e=>e.mail===s.mail))){if(this.reviewers.push(s),this.confirmInvitationCardProps.individualComponentPropsMap[S.T.PEOPLE_PICKER].suggestions=this.reviewers,this.isReturningUser){const e=null===(i=null===(t=this.confirmInvitationCardProps)||void 0===t?void 0:t.individualComponentPropsMap)||void 0===i?void 0:i[S.T.SUBMIT];e&&(e.isFormReadyForSubmission=this.validateBeforeSubmit())}null===(n=this.copilotChatRef.current)||void 0===n||n.updateMessage(this.getConfirmInvitationCardResponseMessage())}},this.copilotChatRef=e,this.session=t,this.userQuery=i||"Start a review on this document",this.documentURL=n||z,this.authorName=s||"Aditya Aswal",this.authorMail=o||"aditysasaaswal@microsoft.com",this.setSuggestionList=a,this.isReviewerNotAddedButtonClicked=r||!1,this.agentLaunchType=d,this.getDocumentSensitivity=g,this.peoplePickerEditorConfig=u}setCallbacks(e,t,i,n){this.onApplySuggestion=e,this.toggleChangeHandler=t,this.addCommentToFirstLineOfDocument=i,this.onSuggestionCardNavigation=n}setFastModeReviewerAgentEnabled(e){this.isFastModeReviewerAgentEnabled=e}getAgentStatus(){return this.agentStatus}static getInstance(e,t,i,n,s,o,a,r,d,l,g){return je.instance||(je.instance=new je(e,t,i,n,s,o,a,r,d,l,g)),je.instance}static destroy(){He.log("ReviewerAgent:: Destroying CopilotCommunicationHandlerImpl instance."),je.instance=void 0}getWorkflowsToRegister(){var e,t;He.log("ReviewerAgent:: getWorkflowsToRegister.");const i=[];return i.push({workflowAnnotationType:y.xj.getTypeName(),shouldHandleResponse:!1,augloopResponseTimerRequired:!0,augloopResponseTimeout:65e3}),He.log("ReviewerAgent:: Registered workflows"),Be(this.telemetryLoggerUtils,re.WorkflowRegisterd,"ReviewerAgentWorkflowRegistered",null!==(e=this.agentID)&&void 0!==e?e:le,null!==(t=this.agentStatus)&&void 0!==t?t:le),i}handoffInitialCard(){this.isInitialCardShown||this.agentLaunchType==ie.LAUNCH_FROM_TOGGLE||(this.showStartupCard(),this.isInitialCardShown=!0)}showStartupCard(){var e;null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:"human",messageHeader:{text:"Start reviewersync"}}},stopLoadingUi:!0})}showAcknowledgementCard(){var e;this.isReviewerNotAddedButtonClicked&&(this.firstMessageText=j),this.firstMessageText&&(null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:p._.MarkdownCard,chatMessageData:{markDownCardProps:{message:this.firstMessageText}},stopLoadingUi:!0}))}getPlainTextChatCardResponse(e,t="chat",i=!0){return{chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:t,messageHeader:{text:e}}},stopLoadingUi:i}}handleRetryButtonClickedForAgentFailure(e,t,i){return(0,d.__awaiter)(this,void 0,void 0,(function*(){this.sendUIStateSyncSignal(),this.removeActionButtonFromLastCard()}))}sendResponseToClient(e){var t,i,o,a,r,d,l,g,u,c,h,v,C,m,R,S,I,y,E,T,A,D;He.log("ReviewerAgent:: SendResponseToClient.",e),this.isReturningUser=!1;const _=e.id;if(!this.annotationId||this.annotationId!==_){if(this.annotationId&&this.annotationId===_||(this.annotationId=_),(null===(t=e.body.chatResponse)||void 0===t?void 0:t.status)===w.lC.Success){this.handoffInitialCard();const t=null===(i=e.body.chatResponse)||void 0===i?void 0:i.messages;if((null==t?void 0:t.length)>=2){this.agentLaunchType===ie.LAUNCH_FROM_TOGGLE&&(null===(o=this.copilotChatRef.current)||void 0===o||o.addResponseMessage({chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:f.I.EntryPointCard,reviewAgentInternalCardProps:{isTriggeredFromReviewerAgentPane:!0,onAddDetailsButtonClick:()=>{var e,t;this.isReviewerNotAddedButtonClicked=!1,this.showAcknowledgementCard(),this.showInvitationCard(),He.log("onAddDetailsButtonClick"),Be(this.telemetryLoggerUtils,re.AddDetailsButtonClicked,le,null!==(e=this.agentID)&&void 0!==e?e:le,null!==(t=this.agentStatus)&&void 0!==t?t:le)},onStartReviewButtonClick:()=>{var e,t,i;this.isReviewerNotAddedButtonClicked=!0,this.sendUIStateSyncSignalZeroReviewers(),null===(e=this.copilotChatRef.current)||void 0===e||e.startLoadingUi(),He.log("onStartReviewButtonClick"),Be(this.telemetryLoggerUtils,re.StartReviewButtonClicked,le,null!==(t=this.agentID)&&void 0!==t?t:le,null!==(i=this.agentStatus)&&void 0!==i?i:le)}}}}}})),this.firstMessageText=this.isReviewerNotAddedButtonClicked?j:null===(a=t[0])||void 0===a?void 0:a.text,this.firstMessageText&&this.agentLaunchType!==ie.LAUNCH_FROM_TOGGLE&&(null===(r=this.copilotChatRef.current)||void 0===r||r.addResponseMessage({chatCardType:p._.MarkdownCard,chatMessageData:{markDownCardProps:{message:this.firstMessageText}},stopLoadingUi:!0}));const e=null===(d=t[1])||void 0===d?void 0:d.text;if(He.log("ReviewerAgent:: SendResponseToClient secondMessage mode: ",fe(e)),(e=>{ve.log("ReviewerAgent::  responseMessageText.",e);try{return void 0!==Ee(e)}catch(e){return ve.log("ReviewerAgent::  responseMessageText parsing error: ",e),!1}})(e)&&fe(e)===n.CREATE){He.log("ReviewerAgent:: Create Agent responsePayLoad: ",e),this.agentID=Ie(e);const t=ye(e,this.agentStatus);this.agentStatus=t,this.agentLaunchType===ie.LAUNCH_WITHOUT_REVIEWERS?this.sendUIStateSyncSignalZeroReviewers():this.processInvitationRenderCardRequest(e)}}else if(1===(null==t?void 0:t.length)&&fe(null===(l=t[0])||void 0===l?void 0:l.text)===n.RETURNINGUSER){this.isReturningUser=!0;const e=null===(g=t[0])||void 0===g?void 0:g.text;this.agentID=Ie(e);const i=ye(e,this.agentStatus);if(this.agentStatus=i,Te(e)&&Ae(e)===s.SUMMARYCARD)He.log("ReviewerAgent:: Returning user with responsePayLoad: ",e),this.processSummaryCard(e);else if(Te(e)&&Ae(e)===s.SUGGESTIONCARD)He.log("ReviewerAgent:: Returning user with responsePayLoad: ",e),this.processSuggestionCard(e);else{new Set([ue.INIT,ue.COMPLETED,ue.FAILED,ue.EXPIRED]).has(i)?this.setSuggestionList([]):this.setSuggestionList([W,V,q]);const e=null===(u=t[0])||void 0===u?void 0:u.text;this.agentID=Ie(e),this.commentId=(e=>{var t,i;try{const n=null===(i=null===(t=JSON.parse(e))||void 0===t?void 0:t.payload)||void 0===i?void 0:i.additionalPayload;return n?n.agentCommentId:""}catch(e){return ve.log("Error in parsing agentCommentId",e),""}})(e),this.processInvitationRenderCardRequest(e);const n=ye(e,this.agentStatus);this.agentStatus=n,He.log("ReviewerAgent:: Returning user with responsePayLoad,show suggestion pills ");const s=this.getPlainTextChatCardResponse(we(e));null===(c=this.copilotChatRef.current)||void 0===c||c.addResponseMessage(s)}}}else if((null===(h=e.body.chatResponse)||void 0===h?void 0:h.status)===w.lC.ErrorInExecution){const t=(null===(m=null===(C=null===(v=e.body.chatResponse)||void 0===v?void 0:v.messages)||void 0===C?void 0:C[0])||void 0===m?void 0:m.text)||"{}",i=Ee(t),n=this.getPlainTextChatCardResponse(we(t,J));if((null==i?void 0:i.agentStatus)===ue.INIT&&this.confirmInvitationCardProps&&this.confirmInvitationCardProps.isCardSubmitted){const e=Object.assign(Object.assign({},n),{chatMessageBodyData:{actionButtonList:[be(this.handleRetryButtonClickedForAgentFailure.bind(this))]}});null===(R=this.copilotChatRef.current)||void 0===R||R.addResponseMessage(e),this.setSuggestionList([])}else{null===(S=this.copilotChatRef.current)||void 0===S||S.addResponseMessage(n);const e=n.chatMessageData.defaultMessageProps.messageHeader.text;e.includes("Only the document creator")&&e.includes("can initiate the review process.")?this.setSuggestionList([]):this.setSuggestionList([W,V,q])}}else{const t=null===(E=null===(y=null===(I=e.body.chatResponse)||void 0===I?void 0:I.messages)||void 0===y?void 0:y[0])||void 0===E?void 0:E.text,i=this.getPlainTextChatCardResponse(we(t,J));null===(T=this.copilotChatRef.current)||void 0===T||T.addResponseMessage(i),this.setSuggestionList([W,V,q])}Be(this.telemetryLoggerUtils,re.SendResponseToClient,1==this.isReturningUser?"ReturningUser":"NewUser",null!==(A=this.agentID)&&void 0!==A?A:le,null!==(D=this.agentStatus)&&void 0!==D?D:le)}}processSuggestionCard(e){var t,i,n,s;const o=((e,t,i,n)=>{var s,o,a;return ve.log("ReviewerAgent:: data: ",e),{suggestionIndices:((null===(a=null===(o=null===(s=null==e?void 0:e.props)||void 0===s?void 0:s[0])||void 0===o?void 0:o.props)||void 0===a?void 0:a.suggestionIndices)||[]).map((e=>({onSuggestionCardNavigation:i,onApplySuggestion:t,initialText:e.initialText,suggestedText:e.suggestedText,commentId:e.commentId,changeType:e.changeType,appName:n})))}})(Ee(e),Oe,ke,(null===(n=null===(i=null===(t=this.peoplePickerEditorConfig)||void 0===t?void 0:t.settings)||void 0===i?void 0:i.hostAppName)||void 0===n?void 0:n.toLowerCase())||"");null===(s=this.copilotChatRef.current)||void 0===s||s.addResponseMessage({chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:f.I.SuggestionCard,reviewAgentInternalCardProps:o}}},chatMessageBodyData:{messageId:Q.get(f.I.SuggestionCard)},stopLoadingUi:!0}),this.setSuggestionList([W,V,q])}processSummaryCard(e){var t,i,n,s,o;const a=Ee(e),r=a.props.map((e=>{let t={reviewersWithAction:[],statusMessage:"",labelForReviewedPeople:"",labelForPendingPeople:"",commentsSummaryHeader:"",commentsSummaries:[]};return t=e.props,t}));const d=null===(i=null===(t=null==a?void 0:a.props)||void 0===t?void 0:t[0])||void 0===i?void 0:i.props.areSuggestionsGenerated;null===(n=this.copilotChatRef.current)||void 0===n||n.addResponseMessage({chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:f.I.ReviewStatusCard,reviewAgentInternalCardProps:r[0]}}},chatMessageBodyData:{messageId:Q.get(f.I.ReviewStatusCard)},stopLoadingUi:!0}),d?this.setSuggestionList([W,"Show suggestions",V,q]):this.setSuggestionList([W,V,q]),He.log("ReviewerAgent:: processSummaryCard payload: ",a),Be(this.telemetryLoggerUtils,re.ProcessSummaryCard,le,null!==(s=this.agentID)&&void 0!==s?s:le,null!==(o=this.agentStatus)&&void 0!==o?o:le)}sendEventToClient(e,t){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var t,i;He.log("ReviewerAgent:: SendEventToClient.",e),e==m.PV.CopilotChatLoaded&&(this.invokeReviewAgent(),Be(this.telemetryLoggerUtils,re.ChatPaneLoaded,"SendEventToClient",null!==(t=this.agentID)&&void 0!==t?t:le,null!==(i=this.agentStatus)&&void 0!==i?i:le))}))}invokeReviewAgent(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var e,t;(t=this.getDocumentSensitivity?yield this.getDocumentSensitivity():void 0)&&t.parent&&(ve.log("ReviewerAgent:: sensitivity: ",t),1)?null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:"chat",messageHeader:{text:"I'm sorry, but I can't assist you in initiating a review as this document is marked confidential. Please take a moment to review the sensitivity label and try again."}}},chatMessageBodyData:{actionButtonList:[be()]},stopLoadingUi:!0}):(He.log("ReviewerAgent:: Sending initial signal"),this.sendInitialSignal())}))}getDefaultSignalOperation(e,t,i,n,s){var o,a,r,d,l;let g;He.log("ReviewerAgent:: getDefaultSignalOperation.",e,t),Be(this.telemetryLoggerUtils,re.DefaultSignalOperation,e,null!==(o=this.agentID)&&void 0!==o?o:le,null!==(a=this.agentStatus)&&void 0!==a?a:le);const u={documentConfig:{documentURL:this.documentURL}};var c;e.toLowerCase().includes("status")?(g=Object.assign(Object.assign({},(c=this.agentID,{query:"status review of agent",queryId:(0,pe.A)(),agentId:c,summaryCardSignal:{agentId:c}})),{config:u}),null===(r=this.copilotChatRef.current)||void 0===r||r.updateLoadingComponentProps({loadingUiStringList:X})):e.toLowerCase().includes("close")?g=Object.assign(Object.assign({},Re(this.agentID)),{config:u}):e.toLowerCase().includes("suggestion")?(g=Object.assign(Object.assign({},me(this.agentID)),{config:u}),null===(d=this.copilotChatRef.current)||void 0===d||d.updateLoadingComponentProps({loadingUiStringList:Z})):e.toLowerCase().includes("start")?(g=Object.assign(Object.assign({},Ce({mail:this.authorMail,displayName:this.authorName})),{config:u}),null===(l=this.copilotChatRef.current)||void 0===l||l.updateLoadingComponentProps({loadingUiStringList:Y})):g=Object.assign({},((e,t)=>{let i={query:e,queryId:(0,pe.A)()};return t&&(i=Object.assign(Object.assign({},i),{agentId:t})),i})(e,this.agentID));const h={operation:new v.g0({parentPath:["Signal",I.br.getTypeName()],items:[{id:ne.generateId(),body:new I.br(g)}]}),workflowAnnotationType:y.xj.getTypeName()};return Promise.resolve(h)}getHostSettings(){return{appName:"Testing",appPlatform:"All",devBuild:!0,environment:m.DF.DEV,sessionId:"",augloopUrl:"http://localhost:20080"}}getAuthToken(){return He.log("ReviewerAgent:: getauthtoken"),Promise.resolve("")}shouldSendRequestToAugloop(e){var t,i,n,s,o,a,r,d;if(e.toLowerCase().includes(q.toLowerCase())){const o=new Set([ue.ACTIVE,ue.CRITICAL,ue.INACTIVE]);return Be(this.telemetryLoggerUtils,re.SendRequestToAL,e,null!==(t=this.agentID)&&void 0!==t?t:le,null!==(i=this.agentStatus)&&void 0!==i?i:le),o.has(this.agentStatus)?(null===(n=this.copilotChatRef.current)||void 0===n||n.addResponseMessage({chatCardType:p._.ReviewAgentCard,chatMessageData:{reviewAgentCardProps:{user:"chat",reviewAgentIndividualCardProps:{reviewAgentCardType:f.I.EntryPointCard,reviewAgentInternalCardProps:{isTriggeredFromReviewerAgentPane:!0,isSecondHeaderHidden:!0,isIconHidden:!0,buttonLeftText:G,buttonRightText:"Cancel",reviewAgentDescriptionText:"Closing the review will end access to suggestions and summaries generated for this session. This action cannot be undone.",onAddDetailsButtonClick:()=>{He.log("Cancel button clicked for close agent reviewer"),this.setSuggestionList([W,V,q])},onStartReviewButtonClick:()=>{var e,t;null===(e=this.copilotChatRef.current)||void 0===e||e.addResponseMessage({chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:"human",messageHeader:{text:G}}},stopLoadingUi:!0}),null===(t=this.copilotChatRef.current)||void 0===t||t.startLoadingUi(),this.sendCloseAgentSignal(),this.setSuggestionList([])}}}}}}),this.setSuggestionList([W,V])):(null===(s=this.copilotChatRef.current)||void 0===s||s.addResponseMessage(this.getPlainTextChatCardResponse("Unable to close review at this moment.")),this.setSuggestionList([W,V])),Promise.resolve(!1)}if(e.toLowerCase().includes(W.toLowerCase())){if(new Set([ue.ACTIVE,ue.INACTIVE,ue.CRITICAL]).has(this.agentStatus)){const e=null===(a=null===(o=this.confirmInvitationCardProps)||void 0===o?void 0:o.individualComponentPropsMap)||void 0===a?void 0:a[S.T.SUBMIT];e&&(e.isFormReadyForSubmission=this.validateBeforeSubmit()),null===(r=this.copilotChatRef.current)||void 0===r||r.addResponseMessage(this.getConfirmInvitationCardResponseMessage()),this.setSuggestionList([V,q])}else null===(d=this.copilotChatRef.current)||void 0===d||d.addResponseMessage(this.getPlainTextChatCardResponse("Unable to edit review details at this moment.")),this.setSuggestionList([V,q]);return Promise.resolve(!1)}return Promise.resolve(!0)}getALSession(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){if(He.log("getALSession"),this.session)return this.session;throw new Error("Session is not undefined")}))}sendInitialSignal(){var e,t,i,n,s;He.log("sendInitialSignal"),Be(this.telemetryLoggerUtils,re.SendInitialSignal,le,null!==(e=this.agentID)&&void 0!==e?e:le,null!==(t=this.agentStatus)&&void 0!==t?t:le);const o={documentConfig:{documentURL:this.documentURL}},a=Object.assign(Object.assign({},Ce({mail:this.authorMail,displayName:this.authorName})),{config:o});null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.br.getTypeName()],items:[{id:ne.generateId(),body:new I.br(a)}]}),workflowAnnotationType:y.xj.getTypeName()}),null===(n=this.copilotChatRef.current)||void 0===n||n.startLoadingUi(),null===(s=this.copilotChatRef.current)||void 0===s||s.updateLoadingComponentProps({loadingUiStringList:Y})}sendCloseAgentSignal(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var e,t,i,n;He.log("sendCloseAgentSignal"),Be(this.telemetryLoggerUtils,re.SendCloseAgentSignal,le,null!==(e=this.agentID)&&void 0!==e?e:le,null!==(t=this.agentStatus)&&void 0!==t?t:le);const s={documentConfig:{documentURL:this.documentURL}},o=Object.assign(Object.assign({},Re(this.agentID)),{config:s});null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.br.getTypeName()],items:[{id:ne.generateId(),body:new I.br(o)}]}),workflowAnnotationType:y.xj.getTypeName()}),null===(n=this.copilotChatRef.current)||void 0===n||n.updateLoadingComponentProps({loadingUiStringList:$})}))}getUpdatedReviewDetailsData(){var e,t,i,n,s,o,a,r,d;let l={};const g=null===(t=null===(e=this.returningUserReviewDetailsProps)||void 0===e?void 0:e.individualComponentPropsMap)||void 0===t?void 0:t[S.T.DATE_PICKER];"string"==typeof(null==g?void 0:g.selectedDate)&&(g.selectedDate=new Date(g.selectedDate));const u=null===(i=null==g?void 0:g.selectedDate)||void 0===i?void 0:i.getTime();this.date!==u&&(l=Object.assign(Object.assign({},l),{DUE_DATE:this.date}));const c=(null===(o=null===(s=null===(n=this.returningUserReviewDetailsProps)||void 0===n?void 0:n.individualComponentPropsMap)||void 0===s?void 0:s[S.T.DROP_DOWN])||void 0===o?void 0:o.selectedValue)||ge.NONE;Fe(this.reminder,c)&&(l=Object.assign(Object.assign({},l),{REMINDER_CADENCE:this.reminder}));const h=(null===(d=null===(r=null===(a=this.returningUserReviewDetailsProps)||void 0===a?void 0:a.individualComponentPropsMap)||void 0===r?void 0:r[S.T.PEOPLE_PICKER])||void 0===d?void 0:d.suggestions)||[],p=this.reviewers.filter((e=>!h.some((t=>e.mail===t.mail))));return p.length&&(l=Object.assign(Object.assign({},l),{REVIEWERS:p.map((e=>Object.assign(Object.assign({},e),{commentId:this.commentId,context:this.message})))})),l}getUIStateSyncData(){if(this.isReturningUser){return this.getUpdatedReviewDetailsData()}return{INVITE_EMAIL:this.message,DUE_DATE:this.date,FAST_MODE_ENABLED:this.isFastModeReviewerAgentEnabled,REMINDER_CADENCE:this.reminder,REVIEWERS:this.reviewers.map((e=>Object.assign(Object.assign({},e),{commentId:this.commentId,context:this.message}))),AUTHOR:{displayName:this.authorName,mail:this.authorMail}}}sendUIStateSyncSignal(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var e,t,i,n,s,o;this.reviewers.length>0&&(yield this.notifyClientOnReviewInitiation()),this.confirmInvitationCardProps.isCardSubmitted=!0,this.confirmInvitationCardProps.individualComponentPropsMap[S.T.SUBMIT].isFormReadyForSubmission=!1,null===(e=this.copilotChatRef.current)||void 0===e||e.updateMessage(this.getConfirmInvitationCardResponseMessage()),He.log("sendUIStateSyncSignal"),Be(this.telemetryLoggerUtils,re.SendUIStateSyncSignal,le,null!==(t=this.agentID)&&void 0!==t?t:le,null!==(i=this.agentStatus)&&void 0!==i?i:le);const a=this.getUIStateSyncData(),r={documentConfig:{documentURL:this.documentURL}},d=Object.assign(Object.assign({},Se(a,this.agentID)),{config:r});null===(n=this.copilotChatRef.current)||void 0===n||n.startLoadingUi(),null===(s=this.copilotChatRef.current)||void 0===s||s.submitOperation({operation:new v.g0({parentPath:["Signal",I.br.getTypeName()],items:[{id:ne.generateId(),body:new I.br(d)}]}),workflowAnnotationType:y.xj.getTypeName()}),null===(o=this.copilotChatRef.current)||void 0===o||o.updateLoadingComponentProps({loadingUiStringList:K}),this.setSuggestionList([V,q])}))}validateBeforeSubmit(){if(this.isReturningUser){const e=this.getUpdatedReviewDetailsData(),t=e.DUE_DATE&&e.DUE_DATE>Date.now(),i=e.REVIEWERS&&e.REVIEWERS.length;return!(!t&&!i)}return this.message.length>0&&this.date>Date.now()}sendUIStateSyncSignalZeroReviewers(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){var e,t,i;He.log("sendUIStateSyncSignalZeroReviewers"),Be(this.telemetryLoggerUtils,re.SendUIStateSyncSignalZeroReviewers,le,null!==(e=this.agentID)&&void 0!==e?e:le,null!==(t=this.agentStatus)&&void 0!==t?t:le);const n=new Date;n.setDate(n.getDate()+7);const s={INVITE_EMAIL:"",DUE_DATE:n.getTime(),REMINDER_CADENCE:"1 day before",REVIEWERS:[],AUTHOR:{displayName:this.authorName,mail:this.authorMail}},o={documentConfig:{documentURL:this.documentURL}},a=Object.assign(Object.assign({},Se(s,this.agentID)),{config:o});He.log("sendUIStateSyncSignalZeroReviewers textTile",a),null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.br.getTypeName()],items:[{id:ne.generateId(),body:new I.br(a)}]}),workflowAnnotationType:y.xj.getTypeName()}),this.setSuggestionList([V,q])}))}notifyClientOnReviewInitiation(){return(0,d.__awaiter)(this,void 0,void 0,(function*(){const e=`[via Reviewer]\n\nHello ${this.reviewers.map((e=>e.displayName)).join(", ")}\n\nHere's how you can help with this document review:\n"${this.message}"`;He.log(e),this.commentId=yield this.addCommentToFirstLineOfDocument(null!=e?e:"Please review this document",this.commentId)}))}showActionCard(e){this.copilotChatRef.current.addResponseMessage({chatCardType:p._.Default,chatMessageData:{defaultMessageProps:{user:R.Q9.Human,messageHeader:{text:e}}}})}removeActionButtonFromLastCard(){this.copilotChatRef.current.updateLastMessage({chatCardType:p._.Default,chatMessageBodyData:{actionButtonList:[]},addCardToChatHistory:!1})}sendSuggestionActionSignal(e,t){var i;Ue("sendSuggestionActionSignal");const n={documentConfig:{documentURL:this.documentURL}},s=Object.assign(Object.assign({},((e,t,i,n)=>({query:"suggestion applied",queryId:(0,pe.A)(),agentId:e,suggestionActionSignal:{agentId:e,commentId:t,changeType:i,isValid:n}}))(this.agentID,e,t,!1)),{config:n});null===(i=this.copilotChatRef.current)||void 0===i||i.submitOperation({operation:new v.g0({parentPath:["Signal",I.br.getTypeName()],items:[{id:ne.generateId(),body:new I.br(s)}]}),workflowAnnotationType:y.xj.getTypeName()})}}var Ve=i(758651);const qe=(e,t)=>{Ve.log("onAgentToggleChangeStub")},We=(e,t,i)=>{Ve.log("onApplySuggestionStub: ",e,t,i)},Ge=e=>{Ve.log("onSuggestionCardNavigationStub: ",e)},Je=e=>(Ve.log("addCommentToFirstLineOfDocument: ",e),Promise.resolve("Comment added successfully")),Qe={themePrimary:"#598FEC",themeSecondary:"#8763c2",themeLight:"#0E336A",themeDark:"#464FEB",themeTertiary:"#598FEC",themeDarker:"#353696",themeMedium:"#464FEB",themeDarkAlt:"#3D91FF",themeLighterAlt:"#6CEBE2",themeLighter:"#9270FF",neutralPrimary:"#FFFFFF",neutralLight:"#292929",neutralLighter:"#757575",neutralLighterAlt:"#666666",neutralSecondaryAlt:"#FFFFFF",neutralTertiary:"#3D3D3D",neutralTertiaryAlt:"#3D3D3D",neutralQuaternaryAlt:"#FFFFFF",neutralDark:"#2461CA",black:"#FFFFFF",white:"#000000"},Ye={themePrimary:"#185abd",themeSecondary:"#8763c2",themeLight:"#D2E0F4",themeDark:"#82ABF1",themeTertiary:"#598FEC",themeDarker:"#598FEC",themeMedium:"#82ABF1",themeDarkAlt:"#3D91FF",themeLighterAlt:"#6CEBE2",themeLighter:"#9270FF",neutralLighter:"#f5f5f5",neutralDark:"#1651AA",white:"#FFFFFF"};var Ke=i(162449);const Xe=(0,L.n)((0,Ke.f)({chatFreStack:{height:"calc(100vh - 50px)"},chatUiStack:{top:"20px"}}));var Ze=i(758651);const $e=({isTestApp:e=!1,copilotTelemetryHandler:t,alSession:n,documentURL:s,userQuery:o,onReviewerAgentToggleChange:a,onApplySuggestion:r,addCommentToFirstLineOfDocument:h,onSuggestionCardNavigation:p,peoplePickerEditorConfig:v,isDarkModeEnabled:C=!1,isHighContrastModeEnabled:m=!1,authorName:R,authorEmail:S,isReviewerNotAddedButtonClicked:f=!1,agentLaunchType:I=ie.LAUNCH_WITH_REVIEWERS,getDocumentSensitivity:y,isReviewerToggleEnabled:w=!1})=>{Ze.log("ReviewerAgent: ",n,"IsTestApp: ",e);const E=c.useRef(null),[T,A]=(0,c.useState)([]);(0,c.useEffect)((()=>{}),[T]);const D=(e,t,i)=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){Ze.log("ReviewerAgent:: onApplySuggestionsCbk: ",e,t,i),r&&(yield r(e,t,i))})),_=e=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){Ze.log("ReviewerAgent:: onSuggestionCardNavigationStubCbk: ",e);const t=parseInt(e,16);yield p(t.toString())}));e&&(o="create agent",s="https://www.microsoft.com",R="Aditya Test",S="test@msft.com");const P=je.getInstance(E,e?void 0:n,o,s,R,S,A,f,I,y,v);e?P.setCallbacks(We,qe,Je,Ge):P.setCallbacks(D,a,h,_);const L={settings:{hostAppId:"Word_Online",hostAppName:"Word",hostAppPlatform:"Web",hostAppScenario:"Copilot",hostDefaultLocale:"en-US",isDogfoodEnvironment:!0,resultTime:1e4},telemLogger:{logError:e=>{Ze.log("Shared Copilot CIQ Error Log: ",e)}},entitiesSupported:[],isExpandedECCEnabled:!1},b={headerText:"Reviewer",descriptionText:"I'm the ultimate partner for document reviews, and can help you launch, track progress and resolve review comments.",freImagePath:i(588065),hideGetStartedButton:!0},[N,U]=c.useState(!1),M={trySydneyToggleChecked:!1,trySydneyToggleEnabled:!1,tryWebSearchToggleEnabled:!1,trySydneyToggleOnChange:(e,t)=>{Ze.log("officeaicopilot-test-app: onChange for Try Sydney Toggle")},tryEnterpriseSearchToggleChecked:!1,tryEnterpriseSearchToggleEnabled:!1,tryEnterpriseSearchToggleOnChange:(e,t)=>{Ze.log("officeaicopilot-test-app: onChange for Enterprise Search Toggle")},tryReviewerAgentToggleChecked:!0,tryReviewerAgentToggleEnabled:w,tryReviewerAgentToggleOnChange:a,FastModeReviewerAgentToggleChecked:N,FastModeReviewerAgentToggleEnabled:P.getAgentStatus()===ue.INIT,FastModeReviewerAgentToggleOnChange:(e,t)=>{const i=!N;P.setFastModeReviewerAgentEnabled(i),U(i)}},O=Xe(),k=((e,t)=>Object.assign({isDarkModeEnabled:e,isHighContrastModeEnabled:t},e?Qe:Ye))(C,m);return(0,c.useEffect)((()=>(l.j.setTelemetryHandler(t),()=>{je.destroy()})),[]),c.createElement(u.B,{className:"ms-welcome",style:{display:"flex",gap:"8px",margin:"0px 4px"}},e||n?c.createElement(g.zn,{style:O,chatUiProps:{chatInputV2Props:{pluginsInfo:[],chatPlaceholderMessage:"Type a message for Reviewer",editorConfig:L},changeTopicUiProps:{hideChangeTopicButton:!0},freUiProps:b,toggleUiProps:M,suggestionPillsUiProps:{suggestionList:T}},copilotCommunicationHandler:P,useALRuntime:!!e,copilotTelemetryHandler:t,ref:E,theme:k}):c.createElement("div",null,"ReviewerAgent: alSession is required for non test"))};$e.displayName="Reviewer"},588065:(e,t,i)=>{e.exports=i.p+"assets/fre-reviewer-agent-illustration.svg"}}]);
//# sourceMappingURL=vendors~ReviewerAgent.js.map